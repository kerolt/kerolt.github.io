<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Linux | Kerolt's Blog</title><meta name=keywords content><meta name=description content="ExampleSite description"><meta name=author content="Kerolt"><link rel=canonical href=https://kerolt.github.io/tags/linux/><meta name=google-site-verification content="NpIO0KEIJS0CPRzTzQCbYQdSRIyb0Lspx"><meta name=yandex-verification content="XYZabc"><meta name=msvalidate.01 content="2300A23B82DB579A2DEA6261191AD771"><link crossorigin=anonymous href=/assets/css/stylesheet.679ef4369acccbeadd679a095a08e226e874ee5a0a2930197bc0ed485044db42.css integrity="sha256-Z570NprMy+rdZ5oJWgjiJuh07loKKTAZe8DtSFBE20I=" rel="preload stylesheet" as=style><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/lxgw-wenkai-screen-web/style.css><link rel=icon href=https://kerolt.github.io/images/avatar/favicon.png><link rel=icon type=image/png sizes=16x16 href=https://kerolt.github.io/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=32x32 href=https://kerolt.github.io/%3Clink%20/%20abs%20url%3E><link rel=apple-touch-icon href=https://kerolt.github.io/%3Clink%20/%20abs%20url%3E><link rel=mask-icon href=https://kerolt.github.io/%3Clink%20/%20abs%20url%3E><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate type=application/rss+xml href=https://kerolt.github.io/tags/linux/index.xml><link rel=alternate hreflang=en href=https://kerolt.github.io/tags/linux/><script src=https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js></script><link rel=stylesheet href=https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css><script src=https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js></script><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:url" content="https://kerolt.github.io/tags/linux/"><meta property="og:site_name" content="Kerolt's Blog"><meta property="og:title" content="Linux"><meta property="og:description" content="ExampleSite description"><meta property="og:locale" content="en"><meta property="og:type" content="website"><meta property="og:image" content="https://kerolt.github.io/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://kerolt.github.io/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta name=twitter:title content="Linux"><meta name=twitter:description content="ExampleSite description"></head><body class=list id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://kerolt.github.io/ accesskey=h title="Kerolt's Blog (Alt + H)">Kerolt's Blog</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme">
<svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://kerolt.github.io/posts/ title=文章><span>文章</span></a></li><li><a href=https://kerolt.github.io/categories/ title=分类><span>分类</span></a></li><li><a href=https://kerolt.github.io/tags/ title=标签><span>标签</span></a></li><li><a href=https://kerolt.github.io/archives/ title=归档><span>归档</span></a></li><li><a href=https://kerolt.github.io/about/ title=关于我><span>关于我</span></a></li><li><a href=https://kerolt.github.io/search/ title="🔍 (Alt + /)" accesskey=/><span>🔍</span></a></li></ul></nav></header><main class=main><header class=page-header><div class=breadcrumbs><a href=https://kerolt.github.io/>Home</a>&nbsp;»&nbsp;<a href=https://kerolt.github.io/tags/>Tags</a></div><h1>Linux
<a href=/tags/linux/index.xml title=RSS aria-label=RSS><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" height="23"><path d="M4 11a9 9 0 019 9"/><path d="M4 4a16 16 0 0116 16"/><circle cx="5" cy="19" r="1"/></svg></a></h1></header><article class="post-entry tag-entry"><header class=entry-header><h2 class=entry-hint-parent>Linux修改IP</h2></header><div class=entry-content><p>首先确定网络是用什么工具管理：
$ systemctl is-active NetworkManager active 说明 网络由 NetworkManager 管理，这种情况修改 IP 通常使用 nmcli：
修改静态 IP 看当前连接名 nmcli connection show 输出类似：
NAME UUID TYPE DEVICE Wired connection 1 2d3e1f6a-4e87-4a76-8f23-2f459c8c112b ethernet enp60s0 这里的 NAME（如 Wired connection 1）就是连接名，后面命令要用到。
修改为静态 IP 假设你想把 IP 设置为：
IP：192.168.1.100/24 网关：192.168.1.1 DNS：8.8.8.8, 1.1.1.1 执行：
sudo nmcli con mod "Wired connection 1" ipv4.addresses 192.168.1.100/24 sudo nmcli con mod "Wired connection 1" ipv4.gateway 192.168.1.1 sudo nmcli con mod "Wired connection 1" ipv4.dns "8.8.8.8,1.1.1.1" sudo nmcli con mod "Wired connection 1" ipv4.method manual 注意 "Wired connection 1" 需要替换为你自己的连接名。 如果名字里有空格，必须加引号。
...</p></div><footer class=entry-footer><span title='2025-11-09 00:00:00 +0000 UTC'>发布于2025-11-09</span>&nbsp;&nbsp;·&nbsp;&nbsp;Kerolt</footer><a class=entry-link aria-label="post link to Linux修改IP" href=https://kerolt.github.io/posts/net/linux%E4%BF%AE%E6%94%B9ip/></a></article><article class="post-entry tag-entry"><header class=entry-header><h2 class=entry-hint-parent>Linux校准时间</h2></header><div class=entry-content><p>服务器是用旧笔记本装的 Debian13，然后用 ddns-go 做动态域名解析，但是装好之后貌似由于时钟没有校准因此 ddns-go 无法更新域名解析（使用的 aliyun），以下是解决方法。
首先我使用 timedatectl 的结果如下：
~ $ timedatectl Local time: 六 2025-11-08 00:20:49 CST Universal time: 五 2025-11-07 16:20:49 UTC RTC time: 五 2025-11-07 16:20:49 Time zone: Asia/Shanghai (CST, +0800) System clock synchronized: no NTP service: n/a RTC in local TZ: no 使用 systemd-timesyncd 可以让系统自动校时：
sudo timedatectl set-ntp true 如果显示：
Failed to set ntp: NTP not supported 说明当前系统里没有可用的 NTP 同步服务（比如 systemd-timesyncd、chronyd 或 ntpd）被启用或支持，可以执行：
sudo apt install systemd-timesyncd sudo systemctl enable --now systemd-timesyncd.service 之后再执行 timedatectl 可以看到：
...</p></div><footer class=entry-footer><span title='2025-11-07 00:00:00 +0000 UTC'>发布于2025-11-07</span>&nbsp;&nbsp;·&nbsp;&nbsp;Kerolt</footer><a class=entry-link aria-label="post link to Linux校准时间" href=https://kerolt.github.io/posts/linux/linux%E6%A0%A1%E5%87%86%E6%97%B6%E9%97%B4/></a></article><article class="post-entry tag-entry"><header class=entry-header><h2 class=entry-hint-parent>如何理解内核态与用户态切换的上下文开销</h2></header><div class=entry-content><p>一、什么是“用户态”和“内核态” CPU 有不同的 特权级（Privilege Level）：
用户态（User Mode）： 应用程序在这里运行，权限受限，比如不能直接访问硬件、不能修改页表等。
内核态（Kernel Mode）： 操作系统内核运行在这里，拥有完全的访问权限，可以管理内存、设备、中断等。
二、什么是“上下文切换（Context Switch）” “上下文”就是 CPU 当前正在执行的任务的所有状态，包括：
寄存器内容（RIP、RSP、RAX 等） 程序计数器（Program Counter） 栈指针 内存映射（页表） 调度信息（优先级、时间片等） 上下文切换指的是 CPU 从一个执行上下文切换到另一个（比如进程 A → 进程 B）。
三、内核态与用户态切换 ≠ 进程切换，但都属于“上下文切换” 这两种是不同层次的“切换”：
类型 示例 是否涉及调度 开销大小 备注 用户态 → 内核态 系统调用、I/O、中断 否 小（几十到几百纳秒） 同一线程，只是 CPU 特权级变化 进程上下文切换 从进程 A → 进程 B 是 大（微秒级） 不仅换栈，还要换虚拟内存上下文 四、为什么内核/用户态切换有“开销” 内核态切换的代价来自几个部分：
1. CPU 特权级变化 切换时 CPU 会：
保存当前寄存器状态； 改变特权级（从 ring3 → ring0）； 切换到内核栈（每个线程有独立内核栈）； 执行系统调用入口代码（syscall、sysenter 指令）； 执行完后再反向恢复回用户态。 这些过程虽然不是“线程切换”，但都需要 CPU 做额外操作。
...</p></div><footer class=entry-footer><span title='2025-11-06 00:00:00 +0000 UTC'>发布于2025-11-06</span>&nbsp;&nbsp;·&nbsp;&nbsp;Kerolt</footer><a class=entry-link aria-label="post link to 如何理解内核态与用户态切换的上下文开销" href=https://kerolt.github.io/posts/linux/%E5%A6%82%E4%BD%95%E7%90%86%E8%A7%A3%E5%86%85%E6%A0%B8%E6%80%81%E4%B8%8E%E7%94%A8%E6%88%B7%E6%80%81%E5%88%87%E6%8D%A2%E7%9A%84%E4%B8%8A%E4%B8%8B%E6%96%87%E5%BC%80%E9%94%80/></a></article><article class="post-entry tag-entry"><header class=entry-header><h2 class=entry-hint-parent>Linux NAPI机制知识点总结</h2></header><div class=entry-content><p>对 https://docs.kernel.org/networking/napi.html 的总结
NAPI (New API，但现已无特定含义) 是 Linux 内核中用于高效处理网络数据包的一种机制，旨在减少高负载下的中断开销。
其​目的​​是为了解决传统基于中断的包处理在高流量下的性能问题（“中断活锁”）。通过混合​​中断​​和​​轮询​​模式，在低负载时使用中断保证低延迟，在高负载时切换到轮询保证高吞吐量。
设备通过中断通知有新数据包 -> 内核调度对应的 NAPI 实例 -> 在软中断上下文（或内核线程）中轮询处理多个数据包 -> 处理完毕后再打开中断。
核心数据结构与 API ​​struct napi_struct​​：
核心数据结构，代表一个 NAPI 实例，保存其状态信息。 通常与一个中断或一个队列（RX/TX）相关联。 ​​控制 API (初始化和状态管理)​​：
netif_napi_add() / netif_napi_del(): 向系统添加/删除一个 NAPI 实例（通常附加到网络设备上）。 napi_enable() / napi_disable(): 启用/禁用 NAPI 实例。禁用状态下实例不会被调度，poll 方法不会被调用。​​注意​​：API 非幂等，错误调用顺序可能导致死锁或竞态。 ​​数据路径 API (调度与处理)​​：
napi_schedule(): ​​核心调度函数​​。通常在设备的中断处理程序中调用，通知内核有数据需要处理，并获取 NAPI 实例的所有权。 napi_schedule_irqoff(): napi_schedule() 的变体，用于已知在中断上下文中调用的情况，可优化中断屏蔽操作。 napi_complete_done(): ​​完成处理函数​​。当驱动程序的 poll 方法处理完所有事件后调用此函数，释放实例的所有权。​​警告​​：budget 为 0 时绝不能调用；若处理恰好用完 budget 且工作已完成，需谨慎返回 budget - 1 或等待下次调用。 驱动程序实现要点 ​​poll 方法​​：
驱动必须实现的回调函数，由内核调度执行实际的数据包处理工作。 ​​参数 budget​​：限制一次 poll 调用最多可处理的​​接收​​（RX）数据包数量（发送 TX 处理无此限制）。若返回值为 budget，表示还有工作未完成，内核会再次调度；若小于 budget，表示本轮处理已完成。 ​​中断屏蔽策略​​：
...</p></div><footer class=entry-footer><span title='2025-09-17 00:00:00 +0000 UTC'>发布于2025-09-17</span>&nbsp;&nbsp;·&nbsp;&nbsp;Kerolt</footer><a class=entry-link aria-label="post link to Linux NAPI机制知识点总结" href=https://kerolt.github.io/posts/linux/linux-napi%E6%9C%BA%E5%88%B6%E7%9F%A5%E8%AF%86%E7%82%B9%E6%80%BB%E7%BB%93/></a></article><article class="post-entry tag-entry"><header class=entry-header><h2 class=entry-hint-parent>【问题记录】ddns-go与IPv6网络配置</h2></header><div class=entry-content><p>在完成 Rustdesk 自建服务器 的搭建后，我又想到：由于实验室服务器的公网 IPv6 地址 并非永久不变，直接使用 IP 进行远程连接（如 SSH 或 Rustdesk）并不现实，如何确保远程访问的稳定性和便利性呢。为了解决这一痛点，我决定利用 动态域名解析（DDNS） 技术，配合 ddns-go 和 阿里云 DNS 服务，将服务器的动态 IP 地址实时绑定到一个易于记忆的域名上。
本文将记录我在配置过程中遇到的四个主要问题及其解决方案。
问题 1：IPv6 临时地址导致域名解析不稳定 在启用 ddns-go 服务后，我发现尽管程序运行正常，但我的域名解析记录却频繁失效。经过排查，我意识到罪魁祸首是 IPv6 临时地址（Temporary Address）。这是一种为了增强用户隐私而设计的特性，系统会定期生成新的、临时的 IPv6 地址用于出站连接。当服务器的地址发生变化时，DDNS 服务来不及同步更新，就会导致域名无法解析到正确的 IP 地址。
解决方案：禁用 IPv6 临时地址 要解决这个问题，最直接的方法就是从系统层面禁用 IPv6 临时地址功能，强制使用稳定的、非临时的地址。
编辑 sysctl 配置文件： 使用 vim 或其他编辑器打开 sysctl.conf 文件，该文件用于在系统启动时配置内核参数。 sudo vim /etc/sysctl.conf 添加配置项： 在文件末尾添加以下两行，分别用于全局禁用和默认禁用所有网络接口的 IPv6 临时地址功能。 # 禁用 IPv6 临时地址 net.ipv6.conf.all.use_tempaddr = 0 net.ipv6.conf.enp4s0.use_tempaddr = 0 注意：如果只想针对特定网卡（例如 enp4s0）进行配置，可以添加 net.ipv6.conf.enp4s0.use_tempaddr = 0。你可以通过 ip a 命令查看你机器的网卡名称。
...</p></div><footer class=entry-footer><span title='2025-08-29 00:00:00 +0000 UTC'>发布于2025-08-29</span>&nbsp;&nbsp;·&nbsp;&nbsp;Kerolt</footer><a class=entry-link aria-label="post link to 【问题记录】ddns-go与IPv6网络配置" href=https://kerolt.github.io/posts/net/%E9%97%AE%E9%A2%98%E8%AE%B0%E5%BD%95ddns-go%E4%B8%8Eipv6%E7%BD%91%E7%BB%9C%E9%85%8D%E7%BD%AE/></a></article><article class="post-entry tag-entry"><header class=entry-header><h2 class=entry-hint-parent>【解决】Fedora42升级启动时显示kernel panic</h2></header><div class=entry-content><p>最近 Fedora42 更新了，因此我打算升级一下玩玩。在执行完下面的命令后：
sudo dnf upgrade --refresh sudo dnf system-upgrade download --releasever=42 sudo dnf system-upgrade reboot 重启开机成了这样:(
在网上搜索一圈后，执行以下命令系统就 ok 了：
sudo dracut --regenerate-all --force 错误的原因可能是更新内核后没有正确生成新的 initramfs 文件，系统可能会使用旧的、不兼容的 initramfs 文件，从而导致启动失败。
而 dracut 是一个用于生成 Linux 系统 initramfs（初始内存文件系统）的工具。运行 这条命令后，dracut 会重新生成与当前系统中所有已安装内核对应的 initramfs 文件。
参考：https://www.reddit.com/r/Fedora/comments/1hfkqnq/boot_error_after_updating_to_6124200</p></div><footer class=entry-footer><span title='2025-04-27 00:00:00 +0000 UTC'>发布于2025-04-27</span>&nbsp;&nbsp;·&nbsp;&nbsp;Kerolt</footer><a class=entry-link aria-label="post link to 【解决】Fedora42升级启动时显示kernel panic" href=https://kerolt.github.io/posts/linux/%E8%A7%A3%E5%86%B3fedora42%E5%8D%87%E7%BA%A7%E5%90%AF%E5%8A%A8%E6%97%B6%E6%98%BE%E7%A4%BAkernel-panic/></a></article><article class="post-entry tag-entry"><header class=entry-header><h2 class=entry-hint-parent>解决X11下窗口拖动撕裂的一个方法</h2></header><div class=entry-content><p>Debian 系 Linux 安装 N 卡驱动参考这篇 博客
最近 Debian 终于是装好 nvidia 的驱动了，但是只能用在 X11 上，并且相比于不用 n 卡驱动时的 Wayland，X11 下的窗口拖动和视频播放会有比较明显的撕裂感，以下是解决的一个方法。
...</p></div><footer class=entry-footer><span title='2024-09-03 00:00:00 +0000 UTC'>发布于2024-09-03</span>&nbsp;&nbsp;·&nbsp;&nbsp;Kerolt</footer><a class=entry-link aria-label="post link to 解决X11下窗口拖动撕裂的一个方法" href=https://kerolt.github.io/posts/%E5%AD%A6%E4%B9%A0%E9%9A%8F%E7%AC%94/%E8%A7%A3%E5%86%B3x11%E4%B8%8B%E7%AA%97%E5%8F%A3%E6%8B%96%E5%8A%A8%E6%92%95%E8%A3%82%E7%9A%84%E4%B8%80%E4%B8%AA%E6%96%B9%E6%B3%95/></a></article></main><footer class=footer><span>&copy; 2026 <a href=https://kerolt.github.io/>Kerolt's Blog</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
<a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentColor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>