<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>åœ¨å¼€å‘ä¸€ä¸ªCNIæ’ä»¶æ—¶éœ€è¦å®šä¹‰çš„å‡ ä¸ªé…ç½®æ–‡ä»¶ | Kerolt's Blog</title><meta name=keywords content="CNI"><meta name=description content='åœ¨å¼€å‘ä¸€ä¸ª CNIï¼ˆContainer Network Interfaceï¼‰æ’ä»¶ æ—¶ï¼Œä¸€èˆ¬éœ€è¦å®šä¹‰å‡ ä¸ªå…³é”®é…ç½®æ–‡ä»¶ï¼Œå®ƒä»¬å…±åŒå†³å®šæ’ä»¶çš„è¡Œä¸ºã€ç½‘ç»œé…ç½®æ–¹å¼ã€ä»¥åŠä¸ Kubernetes çš„é›†æˆã€‚
ä¸€ã€CNI ç½‘ç»œé…ç½®æ–‡ä»¶


ä½ç½®ï¼š
é€šå¸¸ä½äº /etc/cni/net.d/ ç›®å½•ä¸‹ï¼ˆå¯ä»¥é€šè¿‡ kubelet å‚æ•° --cni-conf-dir ä¿®æ”¹ï¼‰ã€‚


æ–‡ä»¶åï¼š
ä¸€èˆ¬ä»¥ .confã€.conflist ç»“å°¾ï¼Œä¾‹å¦‚ï¼š
/etc/cni/net.d/10-myplugin.conf
/etc/cni/net.d/10-myplugin.conflist


å†…å®¹ï¼š
JSON æ ¼å¼ï¼Œæè¿°ç½‘ç»œçš„ç±»å‹ã€IPAM é…ç½®ã€è·¯ç”±ç­‰ã€‚


ç¤ºä¾‹ï¼š10-simplecni.conf
{
  "cniVersion": "0.4.0",
  "name": "simple-network",
  "type": "simple-cni",
  "ipam": {
    "type": "host-local",
    "subnet": "10.10.0.0/16",
    "rangeStart": "10.10.0.10",
    "rangeEnd": "10.10.255.254",
    "routes": [
      { "dst": "0.0.0.0/0" }
    ],
    "gateway": "10.10.0.1"
  }
}
å…¶ä¸­ï¼š

typeï¼šå¯¹åº”ä½ ç¼–è¯‘å‡ºçš„æ’ä»¶äºŒè¿›åˆ¶åï¼Œæ¯”å¦‚ /opt/cni/bin/simple-cniã€‚
ipamï¼šIP åœ°å€åˆ†é…æ–¹å¼ã€‚å¯ä»¥æ˜¯ host-localã€dhcp æˆ–ä½ è‡ªå·±å®ç°çš„æ’ä»¶ã€‚
.conflist æ–‡ä»¶å¯ä»¥åŒ…å«å¤šä¸ª CNI æ’ä»¶é“¾ï¼Œç”¨äºç»„åˆæ‰§è¡Œï¼ˆæ¯”å¦‚ Flannel + Portmapï¼‰ã€‚

äºŒã€CNI æ’ä»¶çš„å†…éƒ¨é…ç½®æ–‡ä»¶ï¼ˆæ’ä»¶è‡ªå®šä¹‰ï¼‰
é™¤äº†æ ‡å‡† CNI é…ç½®å¤–ï¼Œå¤§å¤šæ•°æ’ä»¶éƒ½ä¼šå®šä¹‰è‡ªå·±ç‹¬ç«‹çš„é…ç½®æ–‡ä»¶ç›®å½•ï¼Œç”¨æ¥ä¿å­˜è¿è¡Œæ—¶ä¿¡æ¯æˆ–æŒä¹…åŒ–çŠ¶æ€ã€‚
å¸¸è§ä½ç½®ï¼š'><meta name=author content="Kerolt"><link rel=canonical href=https://kerolt.github.io/posts/k8s/%E5%9C%A8%E5%BC%80%E5%8F%91%E4%B8%80%E4%B8%AAcni%E6%8F%92%E4%BB%B6%E6%97%B6%E9%9C%80%E8%A6%81%E5%AE%9A%E4%B9%89%E7%9A%84%E5%87%A0%E4%B8%AA%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6/><meta name=google-site-verification content="NpIO0KEIJS0CPRzTzQCbYQdSRIyb0Lspx"><meta name=yandex-verification content="XYZabc"><meta name=msvalidate.01 content="2300A23B82DB579A2DEA6261191AD771"><link crossorigin=anonymous href=/assets/css/stylesheet.f0919acbfa8bf65c44a042e5b3a8e1ba558a81a96c3fa156fbcade0ffc860c1f.css integrity="sha256-8JGay/qL9lxEoELls6jhulWKgalsP6FW+8reD/yGDB8=" rel="preload stylesheet" as=style><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/cn-fontsource-source-han-serif-sc-vf@1.0.9/font.min.css><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/lxgw-wenkai-screen-web/style.css><link rel=icon href=https://kerolt.github.io/images/avatar/favicon.png><link rel=icon type=image/png sizes=16x16 href=https://kerolt.github.io/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=32x32 href=https://kerolt.github.io/%3Clink%20/%20abs%20url%3E><link rel=apple-touch-icon href=https://kerolt.github.io/%3Clink%20/%20abs%20url%3E><link rel=mask-icon href=https://kerolt.github.io/%3Clink%20/%20abs%20url%3E><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://kerolt.github.io/posts/k8s/%E5%9C%A8%E5%BC%80%E5%8F%91%E4%B8%80%E4%B8%AAcni%E6%8F%92%E4%BB%B6%E6%97%B6%E9%9C%80%E8%A6%81%E5%AE%9A%E4%B9%89%E7%9A%84%E5%87%A0%E4%B8%AA%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6/><script src=https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js></script><link rel=stylesheet href=https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css><script src=https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js></script><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:url" content="https://kerolt.github.io/posts/k8s/%E5%9C%A8%E5%BC%80%E5%8F%91%E4%B8%80%E4%B8%AAcni%E6%8F%92%E4%BB%B6%E6%97%B6%E9%9C%80%E8%A6%81%E5%AE%9A%E4%B9%89%E7%9A%84%E5%87%A0%E4%B8%AA%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6/"><meta property="og:site_name" content="Kerolt's Blog"><meta property="og:title" content="åœ¨å¼€å‘ä¸€ä¸ªCNIæ’ä»¶æ—¶éœ€è¦å®šä¹‰çš„å‡ ä¸ªé…ç½®æ–‡ä»¶"><meta property="og:description" content='åœ¨å¼€å‘ä¸€ä¸ª CNIï¼ˆContainer Network Interfaceï¼‰æ’ä»¶ æ—¶ï¼Œä¸€èˆ¬éœ€è¦å®šä¹‰å‡ ä¸ªå…³é”®é…ç½®æ–‡ä»¶ï¼Œå®ƒä»¬å…±åŒå†³å®šæ’ä»¶çš„è¡Œä¸ºã€ç½‘ç»œé…ç½®æ–¹å¼ã€ä»¥åŠä¸ Kubernetes çš„é›†æˆã€‚
ä¸€ã€CNI ç½‘ç»œé…ç½®æ–‡ä»¶ ä½ç½®ï¼š
é€šå¸¸ä½äº /etc/cni/net.d/ ç›®å½•ä¸‹ï¼ˆå¯ä»¥é€šè¿‡ kubelet å‚æ•° --cni-conf-dir ä¿®æ”¹ï¼‰ã€‚
æ–‡ä»¶åï¼š
ä¸€èˆ¬ä»¥ .confã€.conflist ç»“å°¾ï¼Œä¾‹å¦‚ï¼š
/etc/cni/net.d/10-myplugin.conf /etc/cni/net.d/10-myplugin.conflist å†…å®¹ï¼š
JSON æ ¼å¼ï¼Œæè¿°ç½‘ç»œçš„ç±»å‹ã€IPAM é…ç½®ã€è·¯ç”±ç­‰ã€‚
ç¤ºä¾‹ï¼š10-simplecni.conf
{ "cniVersion": "0.4.0", "name": "simple-network", "type": "simple-cni", "ipam": { "type": "host-local", "subnet": "10.10.0.0/16", "rangeStart": "10.10.0.10", "rangeEnd": "10.10.255.254", "routes": [ { "dst": "0.0.0.0/0" } ], "gateway": "10.10.0.1" } } å…¶ä¸­ï¼š
typeï¼šå¯¹åº”ä½ ç¼–è¯‘å‡ºçš„æ’ä»¶äºŒè¿›åˆ¶åï¼Œæ¯”å¦‚ /opt/cni/bin/simple-cniã€‚ ipamï¼šIP åœ°å€åˆ†é…æ–¹å¼ã€‚å¯ä»¥æ˜¯ host-localã€dhcp æˆ–ä½ è‡ªå·±å®ç°çš„æ’ä»¶ã€‚ .conflist æ–‡ä»¶å¯ä»¥åŒ…å«å¤šä¸ª CNI æ’ä»¶é“¾ï¼Œç”¨äºç»„åˆæ‰§è¡Œï¼ˆæ¯”å¦‚ Flannel + Portmapï¼‰ã€‚ äºŒã€CNI æ’ä»¶çš„å†…éƒ¨é…ç½®æ–‡ä»¶ï¼ˆæ’ä»¶è‡ªå®šä¹‰ï¼‰ é™¤äº†æ ‡å‡† CNI é…ç½®å¤–ï¼Œå¤§å¤šæ•°æ’ä»¶éƒ½ä¼šå®šä¹‰è‡ªå·±ç‹¬ç«‹çš„é…ç½®æ–‡ä»¶ç›®å½•ï¼Œç”¨æ¥ä¿å­˜è¿è¡Œæ—¶ä¿¡æ¯æˆ–æŒä¹…åŒ–çŠ¶æ€ã€‚
å¸¸è§ä½ç½®ï¼š'><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2025-11-04T00:00:00+00:00"><meta property="article:modified_time" content="2025-11-04T00:00:00+00:00"><meta property="article:tag" content="CNI"><meta property="og:image" content="https://kerolt.github.io/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://kerolt.github.io/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta name=twitter:title content="åœ¨å¼€å‘ä¸€ä¸ªCNIæ’ä»¶æ—¶éœ€è¦å®šä¹‰çš„å‡ ä¸ªé…ç½®æ–‡ä»¶"><meta name=twitter:description content='åœ¨å¼€å‘ä¸€ä¸ª CNIï¼ˆContainer Network Interfaceï¼‰æ’ä»¶ æ—¶ï¼Œä¸€èˆ¬éœ€è¦å®šä¹‰å‡ ä¸ªå…³é”®é…ç½®æ–‡ä»¶ï¼Œå®ƒä»¬å…±åŒå†³å®šæ’ä»¶çš„è¡Œä¸ºã€ç½‘ç»œé…ç½®æ–¹å¼ã€ä»¥åŠä¸ Kubernetes çš„é›†æˆã€‚
ä¸€ã€CNI ç½‘ç»œé…ç½®æ–‡ä»¶


ä½ç½®ï¼š
é€šå¸¸ä½äº /etc/cni/net.d/ ç›®å½•ä¸‹ï¼ˆå¯ä»¥é€šè¿‡ kubelet å‚æ•° --cni-conf-dir ä¿®æ”¹ï¼‰ã€‚


æ–‡ä»¶åï¼š
ä¸€èˆ¬ä»¥ .confã€.conflist ç»“å°¾ï¼Œä¾‹å¦‚ï¼š
/etc/cni/net.d/10-myplugin.conf
/etc/cni/net.d/10-myplugin.conflist


å†…å®¹ï¼š
JSON æ ¼å¼ï¼Œæè¿°ç½‘ç»œçš„ç±»å‹ã€IPAM é…ç½®ã€è·¯ç”±ç­‰ã€‚


ç¤ºä¾‹ï¼š10-simplecni.conf
{
  "cniVersion": "0.4.0",
  "name": "simple-network",
  "type": "simple-cni",
  "ipam": {
    "type": "host-local",
    "subnet": "10.10.0.0/16",
    "rangeStart": "10.10.0.10",
    "rangeEnd": "10.10.255.254",
    "routes": [
      { "dst": "0.0.0.0/0" }
    ],
    "gateway": "10.10.0.1"
  }
}
å…¶ä¸­ï¼š

typeï¼šå¯¹åº”ä½ ç¼–è¯‘å‡ºçš„æ’ä»¶äºŒè¿›åˆ¶åï¼Œæ¯”å¦‚ /opt/cni/bin/simple-cniã€‚
ipamï¼šIP åœ°å€åˆ†é…æ–¹å¼ã€‚å¯ä»¥æ˜¯ host-localã€dhcp æˆ–ä½ è‡ªå·±å®ç°çš„æ’ä»¶ã€‚
.conflist æ–‡ä»¶å¯ä»¥åŒ…å«å¤šä¸ª CNI æ’ä»¶é“¾ï¼Œç”¨äºç»„åˆæ‰§è¡Œï¼ˆæ¯”å¦‚ Flannel + Portmapï¼‰ã€‚

äºŒã€CNI æ’ä»¶çš„å†…éƒ¨é…ç½®æ–‡ä»¶ï¼ˆæ’ä»¶è‡ªå®šä¹‰ï¼‰
é™¤äº†æ ‡å‡† CNI é…ç½®å¤–ï¼Œå¤§å¤šæ•°æ’ä»¶éƒ½ä¼šå®šä¹‰è‡ªå·±ç‹¬ç«‹çš„é…ç½®æ–‡ä»¶ç›®å½•ï¼Œç”¨æ¥ä¿å­˜è¿è¡Œæ—¶ä¿¡æ¯æˆ–æŒä¹…åŒ–çŠ¶æ€ã€‚
å¸¸è§ä½ç½®ï¼š'><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://kerolt.github.io/posts/"},{"@type":"ListItem","position":2,"name":"åœ¨å¼€å‘ä¸€ä¸ªCNIæ’ä»¶æ—¶éœ€è¦å®šä¹‰çš„å‡ ä¸ªé…ç½®æ–‡ä»¶","item":"https://kerolt.github.io/posts/k8s/%E5%9C%A8%E5%BC%80%E5%8F%91%E4%B8%80%E4%B8%AAcni%E6%8F%92%E4%BB%B6%E6%97%B6%E9%9C%80%E8%A6%81%E5%AE%9A%E4%B9%89%E7%9A%84%E5%87%A0%E4%B8%AA%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"åœ¨å¼€å‘ä¸€ä¸ªCNIæ’ä»¶æ—¶éœ€è¦å®šä¹‰çš„å‡ ä¸ªé…ç½®æ–‡ä»¶","name":"åœ¨å¼€å‘ä¸€ä¸ªCNIæ’ä»¶æ—¶éœ€è¦å®šä¹‰çš„å‡ ä¸ªé…ç½®æ–‡ä»¶","description":"åœ¨å¼€å‘ä¸€ä¸ª CNIï¼ˆContainer Network Interfaceï¼‰æ’ä»¶ æ—¶ï¼Œä¸€èˆ¬éœ€è¦å®šä¹‰å‡ ä¸ªå…³é”®é…ç½®æ–‡ä»¶ï¼Œå®ƒä»¬å…±åŒå†³å®šæ’ä»¶çš„è¡Œä¸ºã€ç½‘ç»œé…ç½®æ–¹å¼ã€ä»¥åŠä¸ Kubernetes çš„é›†æˆã€‚\nä¸€ã€CNI ç½‘ç»œé…ç½®æ–‡ä»¶ ä½ç½®ï¼š\né€šå¸¸ä½äº /etc/cni/net.d/ ç›®å½•ä¸‹ï¼ˆå¯ä»¥é€šè¿‡ kubelet å‚æ•° --cni-conf-dir ä¿®æ”¹ï¼‰ã€‚\næ–‡ä»¶åï¼š\nä¸€èˆ¬ä»¥ .confã€.conflist ç»“å°¾ï¼Œä¾‹å¦‚ï¼š\n/etc/cni/net.d/10-myplugin.conf /etc/cni/net.d/10-myplugin.conflist å†…å®¹ï¼š\nJSON æ ¼å¼ï¼Œæè¿°ç½‘ç»œçš„ç±»å‹ã€IPAM é…ç½®ã€è·¯ç”±ç­‰ã€‚\nç¤ºä¾‹ï¼š10-simplecni.conf\n{ \u0026#34;cniVersion\u0026#34;: \u0026#34;0.4.0\u0026#34;, \u0026#34;name\u0026#34;: \u0026#34;simple-network\u0026#34;, \u0026#34;type\u0026#34;: \u0026#34;simple-cni\u0026#34;, \u0026#34;ipam\u0026#34;: { \u0026#34;type\u0026#34;: \u0026#34;host-local\u0026#34;, \u0026#34;subnet\u0026#34;: \u0026#34;10.10.0.0/16\u0026#34;, \u0026#34;rangeStart\u0026#34;: \u0026#34;10.10.0.10\u0026#34;, \u0026#34;rangeEnd\u0026#34;: \u0026#34;10.10.255.254\u0026#34;, \u0026#34;routes\u0026#34;: [ { \u0026#34;dst\u0026#34;: \u0026#34;0.0.0.0/0\u0026#34; } ], \u0026#34;gateway\u0026#34;: \u0026#34;10.10.0.1\u0026#34; } } å…¶ä¸­ï¼š\ntypeï¼šå¯¹åº”ä½ ç¼–è¯‘å‡ºçš„æ’ä»¶äºŒè¿›åˆ¶åï¼Œæ¯”å¦‚ /opt/cni/bin/simple-cniã€‚ ipamï¼šIP åœ°å€åˆ†é…æ–¹å¼ã€‚å¯ä»¥æ˜¯ host-localã€dhcp æˆ–ä½ è‡ªå·±å®ç°çš„æ’ä»¶ã€‚ .conflist æ–‡ä»¶å¯ä»¥åŒ…å«å¤šä¸ª CNI æ’ä»¶é“¾ï¼Œç”¨äºç»„åˆæ‰§è¡Œï¼ˆæ¯”å¦‚ Flannel + Portmapï¼‰ã€‚ äºŒã€CNI æ’ä»¶çš„å†…éƒ¨é…ç½®æ–‡ä»¶ï¼ˆæ’ä»¶è‡ªå®šä¹‰ï¼‰ é™¤äº†æ ‡å‡† CNI é…ç½®å¤–ï¼Œå¤§å¤šæ•°æ’ä»¶éƒ½ä¼šå®šä¹‰è‡ªå·±ç‹¬ç«‹çš„é…ç½®æ–‡ä»¶ç›®å½•ï¼Œç”¨æ¥ä¿å­˜è¿è¡Œæ—¶ä¿¡æ¯æˆ–æŒä¹…åŒ–çŠ¶æ€ã€‚\nå¸¸è§ä½ç½®ï¼š\n","keywords":["CNI"],"articleBody":"åœ¨å¼€å‘ä¸€ä¸ª CNIï¼ˆContainer Network Interfaceï¼‰æ’ä»¶ æ—¶ï¼Œä¸€èˆ¬éœ€è¦å®šä¹‰å‡ ä¸ªå…³é”®é…ç½®æ–‡ä»¶ï¼Œå®ƒä»¬å…±åŒå†³å®šæ’ä»¶çš„è¡Œä¸ºã€ç½‘ç»œé…ç½®æ–¹å¼ã€ä»¥åŠä¸ Kubernetes çš„é›†æˆã€‚\nä¸€ã€CNI ç½‘ç»œé…ç½®æ–‡ä»¶ ä½ç½®ï¼š\né€šå¸¸ä½äº /etc/cni/net.d/ ç›®å½•ä¸‹ï¼ˆå¯ä»¥é€šè¿‡ kubelet å‚æ•° --cni-conf-dir ä¿®æ”¹ï¼‰ã€‚\næ–‡ä»¶åï¼š\nä¸€èˆ¬ä»¥ .confã€.conflist ç»“å°¾ï¼Œä¾‹å¦‚ï¼š\n/etc/cni/net.d/10-myplugin.conf /etc/cni/net.d/10-myplugin.conflist å†…å®¹ï¼š\nJSON æ ¼å¼ï¼Œæè¿°ç½‘ç»œçš„ç±»å‹ã€IPAM é…ç½®ã€è·¯ç”±ç­‰ã€‚\nç¤ºä¾‹ï¼š10-simplecni.conf\n{ \"cniVersion\": \"0.4.0\", \"name\": \"simple-network\", \"type\": \"simple-cni\", \"ipam\": { \"type\": \"host-local\", \"subnet\": \"10.10.0.0/16\", \"rangeStart\": \"10.10.0.10\", \"rangeEnd\": \"10.10.255.254\", \"routes\": [ { \"dst\": \"0.0.0.0/0\" } ], \"gateway\": \"10.10.0.1\" } } å…¶ä¸­ï¼š\ntypeï¼šå¯¹åº”ä½ ç¼–è¯‘å‡ºçš„æ’ä»¶äºŒè¿›åˆ¶åï¼Œæ¯”å¦‚ /opt/cni/bin/simple-cniã€‚ ipamï¼šIP åœ°å€åˆ†é…æ–¹å¼ã€‚å¯ä»¥æ˜¯ host-localã€dhcp æˆ–ä½ è‡ªå·±å®ç°çš„æ’ä»¶ã€‚ .conflist æ–‡ä»¶å¯ä»¥åŒ…å«å¤šä¸ª CNI æ’ä»¶é“¾ï¼Œç”¨äºç»„åˆæ‰§è¡Œï¼ˆæ¯”å¦‚ Flannel + Portmapï¼‰ã€‚ äºŒã€CNI æ’ä»¶çš„å†…éƒ¨é…ç½®æ–‡ä»¶ï¼ˆæ’ä»¶è‡ªå®šä¹‰ï¼‰ é™¤äº†æ ‡å‡† CNI é…ç½®å¤–ï¼Œå¤§å¤šæ•°æ’ä»¶éƒ½ä¼šå®šä¹‰è‡ªå·±ç‹¬ç«‹çš„é…ç½®æ–‡ä»¶ç›®å½•ï¼Œç”¨æ¥ä¿å­˜è¿è¡Œæ—¶ä¿¡æ¯æˆ–æŒä¹…åŒ–çŠ¶æ€ã€‚\nå¸¸è§ä½ç½®ï¼š\n/var/lib/simple-cni/ å¸¸ç”¨æ¥å­˜å‚¨åˆ†é…çš„ IPã€å­ç½‘ã€ç½‘å¡ä¿¡æ¯ç­‰ã€‚ä¾‹å¦‚ï¼š\n/var/lib/simple-cni/subnets.json /var/lib/simple-cni/allocations.json ç¤ºä¾‹ï¼š/var/lib/simple-cni/subnets.json\n{ \"subnets\": [ { \"name\": \"default\", \"range\": \"10.10.0.0/16\", \"allocated\": [\"10.10.0.10\", \"10.10.0.11\"] } ] } è¿™ä¸ªæ–‡ä»¶åœ¨ Flannelã€Calicoã€Canal ç­‰æ’ä»¶ä¸­éƒ½æœ‰ç±»ä¼¼å½¢å¼ï¼ˆæ¯”å¦‚ /run/flannel/subnet.envï¼‰ã€‚\nä¸‰ã€Kubernetes é›†æˆç›¸å…³é…ç½®æ–‡ä»¶ 3.1 CNI æ’ä»¶äºŒè¿›åˆ¶è·¯å¾„ è·¯å¾„ï¼š\n/opt/cni/bin/ kubelet å¯åŠ¨å‚æ•° --cni-bin-dir æ§åˆ¶è·¯å¾„ã€‚ ä¾‹å¦‚ï¼š\n/opt/cni/bin/simple-cni /opt/cni/bin/host-local /opt/cni/bin/loopback 3.2 Kubernetes èŠ‚ç‚¹é…ç½®ï¼ˆå¯é€‰ï¼‰ æŸäº›æ’ä»¶ï¼ˆå¦‚ Flannelã€Calicoï¼‰ä¼šä¾èµ– Kubernetes ä¸­çš„ ConfigMap æ¥ä¼ é€’é…ç½®ï¼Œæ¯”å¦‚ï¼š\napiVersion: v1 kind: ConfigMap metadata: name: simple-cni-config namespace: kube-system data: cni-conf.json: | { \"name\": \"simple-network\", \"type\": \"simple-cni\", \"ipam\": { \"type\": \"simple-ipam\", \"subnet\": \"10.10.0.0/16\" } } æ’ä»¶çš„å®‰è£… DaemonSet ä¼šåœ¨å®¹å™¨å¯åŠ¨æ—¶å°†è¯¥é…ç½®å†™å…¥ /etc/cni/net.d/ã€‚\næ€»ç»“ ç±»å‹ æ–‡ä»¶è·¯å¾„ ä½œç”¨ ç”±è°æä¾›/ç®¡ç† CNI ç½‘ç»œé…ç½® /etc/cni/net.d/*.conf å®šä¹‰ CNI ç½‘ç»œè¡Œä¸ºã€æ’ä»¶ç±»å‹ ç®¡ç†å‘˜ / DaemonSet æ’ä»¶äºŒè¿›åˆ¶ /opt/cni/bin/* å¯æ‰§è¡Œæ’ä»¶ç¨‹åº æ’ä»¶å®‰è£…ç¨‹åº çŠ¶æ€æ–‡ä»¶ /var/lib//... å­˜å‚¨åˆ†é…ä¿¡æ¯ã€ç¼“å­˜ æ’ä»¶è‡ªèº« åŠ¨æ€é…ç½®ï¼ˆå¯é€‰ï¼‰ /run//... è¿è¡Œæ—¶ä¿¡æ¯ï¼ˆå¦‚ Socketã€Lockï¼‰ æ’ä»¶è‡ªèº« K8s ConfigMapï¼ˆå¯é€‰ï¼‰ - é›†ç¾¤èŒƒå›´é…ç½®åŒæ­¥ æ’ä»¶æ§åˆ¶å™¨ / DaemonSet å‡ ä¸ªé…ç½®æ–‡ä»¶ä¸ºä»€ä¹ˆè¦æ”¾ä¸åŒçš„ç›®å½•ä¸‹ï¼š\nå¯åŠ¨é˜¶æ®µï¼ˆé…ç½®åŠ è½½ï¼‰\næ’ä»¶ä» /etc/cni/net.d/ è¯»å–ç½‘ç»œé…ç½®ï¼ˆä¾‹å¦‚ç½‘æ®µã€è·¯ç”±æ–¹å¼ç­‰ï¼‰ã€‚\nè¿è¡Œé˜¶æ®µï¼ˆçŠ¶æ€ç”Ÿæˆï¼‰\næ’ä»¶è¿è¡Œæ—¶ï¼Œä¼šåœ¨ /run/simple-cni/ å†™å…¥å½“å‰èŠ‚ç‚¹æˆ–è¿›ç¨‹çº§çš„è¿è¡Œæ—¶çŠ¶æ€ï¼Œå¦‚ï¼š\nå½“å‰åˆ†é…çš„å­ç½‘ï¼ˆsubnets.jsonï¼‰ï¼› å…¶ä»–èŠ‚ç‚¹åŒæ­¥ä¿¡æ¯ã€‚ è¿™äº›æ•°æ®æ˜¯ä¸´æ—¶çš„ï¼Œé‡å¯åå¯é‡æ–°è®¡ç®—ã€‚å­ç½‘å¹¶ä¸æ˜¯ä¸€æˆä¸å˜çš„ï¼Œå¯èƒ½èŠ‚ç‚¹é‡å¯åæˆ–è€…ç½‘ç»œåˆ†é…æ—¶ä¼šæ”¹å˜ï¼Œæ‰€ä»¥ä¸åº”è¯¥æ”¾åœ¨ /var/lib/ ä¸‹æŒä¹…åŒ–ã€‚\nåˆ†é…é˜¶æ®µï¼ˆçŠ¶æ€æŒä¹…åŒ–ï¼‰\næ’ä»¶æ¯å½“åˆ†é…ä¸€ä¸ª IPï¼Œä¼šåœ¨ /var/lib/cni/networks// ä¸­æŒä¹…åŒ–ï¼š\nå“ªä¸ªå®¹å™¨ç”¨äº†å“ªä¸ª IPï¼› æœ€åä¸€ä¸ªåˆ†é…çš„åœ°å€ï¼ˆç”¨äºä¸‹æ¬¡é€’å¢ï¼‰ã€‚ è¿™äº›æ•°æ®å¿…é¡»æŒä¹…åŒ–ï¼Œå¦åˆ™é‡å¯åä¼šå‡ºç° IP é‡å¤åˆ†é…å†²çªã€‚\n","wordCount":"212","inLanguage":"en","image":"https://kerolt.github.io/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E","datePublished":"2025-11-04T00:00:00Z","dateModified":"2025-11-04T00:00:00Z","author":{"@type":"Person","name":"Kerolt"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://kerolt.github.io/posts/k8s/%E5%9C%A8%E5%BC%80%E5%8F%91%E4%B8%80%E4%B8%AAcni%E6%8F%92%E4%BB%B6%E6%97%B6%E9%9C%80%E8%A6%81%E5%AE%9A%E4%B9%89%E7%9A%84%E5%87%A0%E4%B8%AA%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6/"},"publisher":{"@type":"Organization","name":"Kerolt's Blog","logo":{"@type":"ImageObject","url":"https://kerolt.github.io/images/avatar/favicon.png"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://kerolt.github.io/ accesskey=h title="Kerolt's Blog (Alt + H)">Kerolt's Blog</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme">
<svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://kerolt.github.io/posts/ title=æ–‡ç« ><span>æ–‡ç« </span></a></li><li><a href=https://kerolt.github.io/categories/ title=åˆ†ç±»><span>åˆ†ç±»</span></a></li><li><a href=https://kerolt.github.io/tags/ title=æ ‡ç­¾><span>æ ‡ç­¾</span></a></li><li><a href=https://kerolt.github.io/archives/ title=å½’æ¡£><span>å½’æ¡£</span></a></li><li><a href=https://kerolt.github.io/about/ title=å…³äºæˆ‘><span>å…³äºæˆ‘</span></a></li><li><a href=https://kerolt.github.io/search/ title="ğŸ” (Alt + /)" accesskey=/><span>ğŸ”</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://kerolt.github.io/>Home</a>&nbsp;Â»&nbsp;<a href=https://kerolt.github.io/posts/>Posts</a></div><h1 class="post-title entry-hint-parent">åœ¨å¼€å‘ä¸€ä¸ªCNIæ’ä»¶æ—¶éœ€è¦å®šä¹‰çš„å‡ ä¸ªé…ç½®æ–‡ä»¶</h1><div class=post-meta><span title='2025-11-04 00:00:00 +0000 UTC'>å‘å¸ƒäº2025-11-04</span>&nbsp;&nbsp;Â·&nbsp;&nbsp;Kerolt</div><ul class=post-tags><li><a href=https://kerolt.github.io/tags/cni/>CNI</a></li></ul></header><aside id=toc-container class="toc-container wide"><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#%e4%b8%80cni-%e7%bd%91%e7%bb%9c%e9%85%8d%e7%bd%ae%e6%96%87%e4%bb%b6 aria-label="ä¸€ã€CNI ç½‘ç»œé…ç½®æ–‡ä»¶">ä¸€ã€CNI ç½‘ç»œé…ç½®æ–‡ä»¶</a></li><li><a href=#%e4%ba%8ccni-%e6%8f%92%e4%bb%b6%e7%9a%84%e5%86%85%e9%83%a8%e9%85%8d%e7%bd%ae%e6%96%87%e4%bb%b6%e6%8f%92%e4%bb%b6%e8%87%aa%e5%ae%9a%e4%b9%89 aria-label="äºŒã€CNI æ’ä»¶çš„å†…éƒ¨é…ç½®æ–‡ä»¶ï¼ˆæ’ä»¶è‡ªå®šä¹‰ï¼‰">äºŒã€CNI æ’ä»¶çš„å†…éƒ¨é…ç½®æ–‡ä»¶ï¼ˆæ’ä»¶è‡ªå®šä¹‰ï¼‰</a></li><li><a href=#%e4%b8%89kubernetes-%e9%9b%86%e6%88%90%e7%9b%b8%e5%85%b3%e9%85%8d%e7%bd%ae%e6%96%87%e4%bb%b6 aria-label="ä¸‰ã€Kubernetes é›†æˆç›¸å…³é…ç½®æ–‡ä»¶">ä¸‰ã€Kubernetes é›†æˆç›¸å…³é…ç½®æ–‡ä»¶</a><ul><li><a href=#31-cni-%e6%8f%92%e4%bb%b6%e4%ba%8c%e8%bf%9b%e5%88%b6%e8%b7%af%e5%be%84 aria-label="3.1 CNI æ’ä»¶äºŒè¿›åˆ¶è·¯å¾„">3.1 <strong>CNI æ’ä»¶äºŒè¿›åˆ¶è·¯å¾„</strong></a></li><li><a href=#32-kubernetes-%e8%8a%82%e7%82%b9%e9%85%8d%e7%bd%ae%e5%8f%af%e9%80%89 aria-label="3.2 Kubernetes èŠ‚ç‚¹é…ç½®ï¼ˆå¯é€‰ï¼‰">3.2 <strong>Kubernetes èŠ‚ç‚¹é…ç½®ï¼ˆå¯é€‰ï¼‰</strong></a></li></ul></li><li><a href=#%e6%80%bb%e7%bb%93 aria-label=æ€»ç»“>æ€»ç»“</a></li></ul></div></details></div></aside><script>let activeElement,elements;window.addEventListener("DOMContentLoaded",function(){checkTocPosition(),elements=document.querySelectorAll("h1[id],h2[id],h3[id],h4[id],h5[id],h6[id]"),activeElement=elements[0];const t=encodeURI(activeElement.getAttribute("id")).toLowerCase();document.querySelector(`.inner ul li a[href="#${t}"]`).classList.add("active")},!1),window.addEventListener("resize",function(){checkTocPosition()},!1),window.addEventListener("scroll",()=>{activeElement=Array.from(elements).find(e=>{if(getOffsetTop(e)-window.pageYOffset>0&&getOffsetTop(e)-window.pageYOffset<window.innerHeight/2)return e})||activeElement,elements.forEach(e=>{const t=encodeURI(e.getAttribute("id")).toLowerCase();e===activeElement?document.querySelector(`.inner ul li a[href="#${t}"]`).classList.add("active"):document.querySelector(`.inner ul li a[href="#${t}"]`).classList.remove("active")})},!1);const main=parseInt(getComputedStyle(document.body).getPropertyValue("--article-width"),10),toc=parseInt(getComputedStyle(document.body).getPropertyValue("--toc-width"),10),gap=parseInt(getComputedStyle(document.body).getPropertyValue("--gap"),10);function checkTocPosition(){const e=document.body.scrollWidth;e-main-toc*2-gap*4>0?document.getElementById("toc-container").classList.add("wide"):document.getElementById("toc-container").classList.remove("wide")}function getOffsetTop(e){if(!e.getClientRects().length)return 0;let t=e.getBoundingClientRect(),n=e.ownerDocument.defaultView;return t.top+n.pageYOffset}</script><div class=post-content><p>åœ¨å¼€å‘ä¸€ä¸ª <strong>CNIï¼ˆContainer Network Interfaceï¼‰æ’ä»¶</strong> æ—¶ï¼Œä¸€èˆ¬éœ€è¦å®šä¹‰å‡ ä¸ª<strong>å…³é”®é…ç½®æ–‡ä»¶</strong>ï¼Œå®ƒä»¬å…±åŒå†³å®šæ’ä»¶çš„è¡Œä¸ºã€ç½‘ç»œé…ç½®æ–¹å¼ã€ä»¥åŠä¸ Kubernetes çš„é›†æˆã€‚</p><h2 id=ä¸€cni-ç½‘ç»œé…ç½®æ–‡ä»¶>ä¸€ã€CNI ç½‘ç»œé…ç½®æ–‡ä»¶<a hidden class=anchor aria-hidden=true href=#ä¸€cni-ç½‘ç»œé…ç½®æ–‡ä»¶>#</a></h2><ul><li><p><strong>ä½ç½®ï¼š</strong><br>é€šå¸¸ä½äº <code>/etc/cni/net.d/</code> ç›®å½•ä¸‹ï¼ˆå¯ä»¥é€šè¿‡ kubelet å‚æ•° <code>--cni-conf-dir</code> ä¿®æ”¹ï¼‰ã€‚</p></li><li><p><strong>æ–‡ä»¶åï¼š</strong><br>ä¸€èˆ¬ä»¥ <code>.conf</code>ã€<code>.conflist</code> ç»“å°¾ï¼Œä¾‹å¦‚ï¼š</p><div class=highlight><pre tabindex=0 style=background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>/etc/cni/net.d/10-myplugin.conf
</span></span><span style=display:flex><span>/etc/cni/net.d/10-myplugin.conflist
</span></span></code></pre></div></li><li><p><strong>å†…å®¹ï¼š</strong><br>JSON æ ¼å¼ï¼Œæè¿°ç½‘ç»œçš„ç±»å‹ã€IPAM é…ç½®ã€è·¯ç”±ç­‰ã€‚</p></li></ul><p>ç¤ºä¾‹ï¼š<code>10-simplecni.conf</code></p><div class=highlight><pre tabindex=0 style=background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span>{
</span></span><span style=display:flex><span>  <span style=color:#309;font-weight:700>&#34;cniVersion&#34;</span>: <span style=color:#c30>&#34;0.4.0&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#309;font-weight:700>&#34;name&#34;</span>: <span style=color:#c30>&#34;simple-network&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#309;font-weight:700>&#34;type&#34;</span>: <span style=color:#c30>&#34;simple-cni&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#309;font-weight:700>&#34;ipam&#34;</span>: {
</span></span><span style=display:flex><span>    <span style=color:#309;font-weight:700>&#34;type&#34;</span>: <span style=color:#c30>&#34;host-local&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#309;font-weight:700>&#34;subnet&#34;</span>: <span style=color:#c30>&#34;10.10.0.0/16&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#309;font-weight:700>&#34;rangeStart&#34;</span>: <span style=color:#c30>&#34;10.10.0.10&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#309;font-weight:700>&#34;rangeEnd&#34;</span>: <span style=color:#c30>&#34;10.10.255.254&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#309;font-weight:700>&#34;routes&#34;</span>: [
</span></span><span style=display:flex><span>      { <span style=color:#309;font-weight:700>&#34;dst&#34;</span>: <span style=color:#c30>&#34;0.0.0.0/0&#34;</span> }
</span></span><span style=display:flex><span>    ],
</span></span><span style=display:flex><span>    <span style=color:#309;font-weight:700>&#34;gateway&#34;</span>: <span style=color:#c30>&#34;10.10.0.1&#34;</span>
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>å…¶ä¸­ï¼š</p><ul><li><code>type</code>ï¼šå¯¹åº”ä½ ç¼–è¯‘å‡ºçš„æ’ä»¶äºŒè¿›åˆ¶åï¼Œæ¯”å¦‚ <code>/opt/cni/bin/simple-cni</code>ã€‚</li><li><code>ipam</code>ï¼šIP åœ°å€åˆ†é…æ–¹å¼ã€‚å¯ä»¥æ˜¯ <code>host-local</code>ã€<code>dhcp</code> æˆ–ä½ è‡ªå·±å®ç°çš„æ’ä»¶ã€‚</li><li><code>.conflist</code> æ–‡ä»¶å¯ä»¥åŒ…å«å¤šä¸ª CNI æ’ä»¶é“¾ï¼Œç”¨äºç»„åˆæ‰§è¡Œï¼ˆæ¯”å¦‚ Flannel + Portmapï¼‰ã€‚</li></ul><h2 id=äºŒcni-æ’ä»¶çš„å†…éƒ¨é…ç½®æ–‡ä»¶æ’ä»¶è‡ªå®šä¹‰>äºŒã€CNI æ’ä»¶çš„å†…éƒ¨é…ç½®æ–‡ä»¶ï¼ˆæ’ä»¶è‡ªå®šä¹‰ï¼‰<a hidden class=anchor aria-hidden=true href=#äºŒcni-æ’ä»¶çš„å†…éƒ¨é…ç½®æ–‡ä»¶æ’ä»¶è‡ªå®šä¹‰>#</a></h2><p>é™¤äº†æ ‡å‡† CNI é…ç½®å¤–ï¼Œå¤§å¤šæ•°æ’ä»¶éƒ½ä¼šå®šä¹‰è‡ªå·±ç‹¬ç«‹çš„é…ç½®æ–‡ä»¶ç›®å½•ï¼Œç”¨æ¥<strong>ä¿å­˜è¿è¡Œæ—¶ä¿¡æ¯æˆ–æŒä¹…åŒ–çŠ¶æ€</strong>ã€‚</p><p><strong>å¸¸è§ä½ç½®ï¼š</strong></p><div class=highlight><pre tabindex=0 style=background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-gdscript3 data-lang=gdscript3><span style=display:flex><span><span style=color:#555>/</span><span style=color:#069;font-weight:700>var</span><span style=color:#555>/</span>lib<span style=color:#555>/</span>simple<span style=color:#555>-</span>cni<span style=color:#555>/</span>
</span></span></code></pre></div><p>å¸¸ç”¨æ¥å­˜å‚¨åˆ†é…çš„ IPã€å­ç½‘ã€ç½‘å¡ä¿¡æ¯ç­‰ã€‚ä¾‹å¦‚ï¼š</p><div class=highlight><pre tabindex=0 style=background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-gdscript3 data-lang=gdscript3><span style=display:flex><span><span style=color:#555>/</span><span style=color:#069;font-weight:700>var</span><span style=color:#555>/</span>lib<span style=color:#555>/</span>simple<span style=color:#555>-</span>cni<span style=color:#555>/</span>subnets<span style=color:#555>.</span>json
</span></span><span style=display:flex><span><span style=color:#555>/</span><span style=color:#069;font-weight:700>var</span><span style=color:#555>/</span>lib<span style=color:#555>/</span>simple<span style=color:#555>-</span>cni<span style=color:#555>/</span>allocations<span style=color:#555>.</span>json
</span></span></code></pre></div><p>ç¤ºä¾‹ï¼š<code>/var/lib/simple-cni/subnets.json</code></p><div class=highlight><pre tabindex=0 style=background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span>{
</span></span><span style=display:flex><span>  <span style=color:#309;font-weight:700>&#34;subnets&#34;</span>: [
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>      <span style=color:#309;font-weight:700>&#34;name&#34;</span>: <span style=color:#c30>&#34;default&#34;</span>,
</span></span><span style=display:flex><span>      <span style=color:#309;font-weight:700>&#34;range&#34;</span>: <span style=color:#c30>&#34;10.10.0.0/16&#34;</span>,
</span></span><span style=display:flex><span>      <span style=color:#309;font-weight:700>&#34;allocated&#34;</span>: [<span style=color:#c30>&#34;10.10.0.10&#34;</span>, <span style=color:#c30>&#34;10.10.0.11&#34;</span>]
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  ]
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>è¿™ä¸ªæ–‡ä»¶åœ¨ Flannelã€Calicoã€Canal ç­‰æ’ä»¶ä¸­éƒ½æœ‰ç±»ä¼¼å½¢å¼ï¼ˆæ¯”å¦‚ <code>/run/flannel/subnet.env</code>ï¼‰ã€‚</p><h2 id=ä¸‰kubernetes-é›†æˆç›¸å…³é…ç½®æ–‡ä»¶>ä¸‰ã€Kubernetes é›†æˆç›¸å…³é…ç½®æ–‡ä»¶<a hidden class=anchor aria-hidden=true href=#ä¸‰kubernetes-é›†æˆç›¸å…³é…ç½®æ–‡ä»¶>#</a></h2><h3 id=31-cni-æ’ä»¶äºŒè¿›åˆ¶è·¯å¾„>3.1 <strong>CNI æ’ä»¶äºŒè¿›åˆ¶è·¯å¾„</strong><a hidden class=anchor aria-hidden=true href=#31-cni-æ’ä»¶äºŒè¿›åˆ¶è·¯å¾„>#</a></h3><p><strong>è·¯å¾„ï¼š</strong></p><div class=highlight><pre tabindex=0 style=background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>/opt/cni/bin/
</span></span></code></pre></div><ul><li>kubelet å¯åŠ¨å‚æ•° <code>--cni-bin-dir</code> æ§åˆ¶è·¯å¾„ã€‚</li></ul><p>ä¾‹å¦‚ï¼š</p><div class=highlight><pre tabindex=0 style=background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>/opt/cni/bin/simple-cni
</span></span><span style=display:flex><span>/opt/cni/bin/host-local
</span></span><span style=display:flex><span>/opt/cni/bin/loopback
</span></span></code></pre></div><h3 id=32-kubernetes-èŠ‚ç‚¹é…ç½®å¯é€‰>3.2 <strong>Kubernetes èŠ‚ç‚¹é…ç½®ï¼ˆå¯é€‰ï¼‰</strong><a hidden class=anchor aria-hidden=true href=#32-kubernetes-èŠ‚ç‚¹é…ç½®å¯é€‰>#</a></h3><p>æŸäº›æ’ä»¶ï¼ˆå¦‚ Flannelã€Calicoï¼‰ä¼šä¾èµ– Kubernetes ä¸­çš„ ConfigMap æ¥ä¼ é€’é…ç½®ï¼Œæ¯”å¦‚ï¼š</p><div class=highlight><pre tabindex=0 style=background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#309;font-weight:700>apiVersion</span>:<span style=color:#bbb> </span>v1<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#309;font-weight:700>kind</span>:<span style=color:#bbb> </span>ConfigMap<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#309;font-weight:700>metadata</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:#309;font-weight:700>name</span>:<span style=color:#bbb> </span>simple-cni-config<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:#309;font-weight:700>namespace</span>:<span style=color:#bbb> </span>kube-system<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#309;font-weight:700>data</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:#309;font-weight:700>cni-conf.json</span>:<span style=color:#bbb> </span>|<span style=color:#c30;font-style:italic>
</span></span></span><span style=display:flex><span><span style=color:#c30;font-style:italic>    {
</span></span></span><span style=display:flex><span><span style=color:#c30;font-style:italic>      &#34;name&#34;: &#34;simple-network&#34;,
</span></span></span><span style=display:flex><span><span style=color:#c30;font-style:italic>      &#34;type&#34;: &#34;simple-cni&#34;,
</span></span></span><span style=display:flex><span><span style=color:#c30;font-style:italic>      &#34;ipam&#34;: {
</span></span></span><span style=display:flex><span><span style=color:#c30;font-style:italic>        &#34;type&#34;: &#34;simple-ipam&#34;,
</span></span></span><span style=display:flex><span><span style=color:#c30;font-style:italic>        &#34;subnet&#34;: &#34;10.10.0.0/16&#34;
</span></span></span><span style=display:flex><span><span style=color:#c30;font-style:italic>      }
</span></span></span><span style=display:flex><span><span style=color:#c30;font-style:italic>    }</span><span style=color:#bbb>
</span></span></span></code></pre></div><p>æ’ä»¶çš„å®‰è£… DaemonSet ä¼šåœ¨å®¹å™¨å¯åŠ¨æ—¶å°†è¯¥é…ç½®å†™å…¥ <code>/etc/cni/net.d/</code>ã€‚</p><h2 id=æ€»ç»“>æ€»ç»“<a hidden class=anchor aria-hidden=true href=#æ€»ç»“>#</a></h2><table><thead><tr><th>ç±»å‹</th><th>æ–‡ä»¶è·¯å¾„</th><th>ä½œç”¨</th><th>ç”±è°æä¾›/ç®¡ç†</th></tr></thead><tbody><tr><td><strong>CNI ç½‘ç»œé…ç½®</strong></td><td><code>/etc/cni/net.d/*.conf</code></td><td>å®šä¹‰ CNI ç½‘ç»œè¡Œä¸ºã€æ’ä»¶ç±»å‹</td><td>ç®¡ç†å‘˜ / DaemonSet</td></tr><tr><td><strong>æ’ä»¶äºŒè¿›åˆ¶</strong></td><td><code>/opt/cni/bin/*</code></td><td>å¯æ‰§è¡Œæ’ä»¶ç¨‹åº</td><td>æ’ä»¶å®‰è£…ç¨‹åº</td></tr><tr><td><strong>çŠ¶æ€æ–‡ä»¶</strong></td><td><code>/var/lib/&lt;plugin>/...</code></td><td>å­˜å‚¨åˆ†é…ä¿¡æ¯ã€ç¼“å­˜</td><td>æ’ä»¶è‡ªèº«</td></tr><tr><td><strong>åŠ¨æ€é…ç½®ï¼ˆå¯é€‰ï¼‰</strong></td><td><code>/run/&lt;plugin>/...</code></td><td>è¿è¡Œæ—¶ä¿¡æ¯ï¼ˆå¦‚ Socketã€Lockï¼‰</td><td>æ’ä»¶è‡ªèº«</td></tr><tr><td><strong>K8s ConfigMapï¼ˆå¯é€‰ï¼‰</strong></td><td>-</td><td>é›†ç¾¤èŒƒå›´é…ç½®åŒæ­¥</td><td>æ’ä»¶æ§åˆ¶å™¨ / DaemonSet</td></tr></tbody></table><p>å‡ ä¸ªé…ç½®æ–‡ä»¶ä¸ºä»€ä¹ˆè¦æ”¾ä¸åŒçš„ç›®å½•ä¸‹ï¼š</p><ol><li><p>å¯åŠ¨é˜¶æ®µï¼ˆé…ç½®åŠ è½½ï¼‰</p><p>æ’ä»¶ä» <code>/etc/cni/net.d/</code> è¯»å–ç½‘ç»œé…ç½®ï¼ˆä¾‹å¦‚ç½‘æ®µã€è·¯ç”±æ–¹å¼ç­‰ï¼‰ã€‚</p></li><li><p>è¿è¡Œé˜¶æ®µï¼ˆçŠ¶æ€ç”Ÿæˆï¼‰</p><p>æ’ä»¶è¿è¡Œæ—¶ï¼Œä¼šåœ¨ <code>/run/simple-cni/</code> å†™å…¥å½“å‰èŠ‚ç‚¹æˆ–è¿›ç¨‹çº§çš„è¿è¡Œæ—¶çŠ¶æ€ï¼Œå¦‚ï¼š</p><ul><li>å½“å‰åˆ†é…çš„å­ç½‘ï¼ˆsubnets.jsonï¼‰ï¼›</li><li>å…¶ä»–èŠ‚ç‚¹åŒæ­¥ä¿¡æ¯ã€‚</li></ul><p>è¿™äº›æ•°æ®æ˜¯ä¸´æ—¶çš„ï¼Œé‡å¯åå¯é‡æ–°è®¡ç®—ã€‚å­ç½‘å¹¶ä¸æ˜¯ä¸€æˆä¸å˜çš„ï¼Œå¯èƒ½èŠ‚ç‚¹é‡å¯åæˆ–è€…ç½‘ç»œåˆ†é…æ—¶ä¼šæ”¹å˜ï¼Œæ‰€ä»¥ä¸åº”è¯¥æ”¾åœ¨ <code>/var/lib/</code> ä¸‹æŒä¹…åŒ–ã€‚</p></li><li><p>åˆ†é…é˜¶æ®µï¼ˆçŠ¶æ€æŒä¹…åŒ–ï¼‰</p><p>æ’ä»¶æ¯å½“åˆ†é…ä¸€ä¸ª IPï¼Œä¼šåœ¨ <code>/var/lib/cni/networks/&lt;netname>/</code> ä¸­æŒä¹…åŒ–ï¼š</p><ul><li>å“ªä¸ªå®¹å™¨ç”¨äº†å“ªä¸ª IPï¼›</li><li>æœ€åä¸€ä¸ªåˆ†é…çš„åœ°å€ï¼ˆç”¨äºä¸‹æ¬¡é€’å¢ï¼‰ã€‚</li></ul><p>è¿™äº›æ•°æ®å¿…é¡»æŒä¹…åŒ–ï¼Œå¦åˆ™é‡å¯åä¼šå‡ºç° IP é‡å¤åˆ†é…å†²çªã€‚</p></li></ol></div><footer class=post-footer><nav class=paginav><a class=prev href=https://kerolt.github.io/posts/linux/%E5%A6%82%E4%BD%95%E7%90%86%E8%A7%A3%E5%86%85%E6%A0%B8%E6%80%81%E4%B8%8E%E7%94%A8%E6%88%B7%E6%80%81%E5%88%87%E6%8D%A2%E7%9A%84%E4%B8%8A%E4%B8%8B%E6%96%87%E5%BC%80%E9%94%80/><span class=title>Â« Prev</span><br><span>å¦‚ä½•ç†è§£å†…æ ¸æ€ä¸ç”¨æˆ·æ€åˆ‡æ¢çš„ä¸Šä¸‹æ–‡å¼€é”€</span>
</a><a class=next href=https://kerolt.github.io/posts/k8s/k8s%E4%B8%AD%E7%9A%84%E5%8D%95%E4%B8%80%E8%81%8C%E8%B4%A3%E5%92%8C%E5%AF%B9%E8%B1%A1%E7%BB%84%E5%90%88/><span class=title>Next Â»</span><br><span>K8sä¸­çš„å•ä¸€èŒè´£å’Œå¯¹è±¡ç»„åˆ</span></a></nav></footer></article></main><footer class=footer><span>&copy; 2026 <a href=https://kerolt.github.io/>Kerolt's Blog</a></span> Â·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
<a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentColor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>