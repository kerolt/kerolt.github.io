<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Linuxä¸­çš„vethä¸bridge | Kerolt's Blog</title><meta name=keywords content="veth,bridge"><meta name=description content="å®¹å™¨ç½‘ç»œæœ€å…¸å‹çš„åŸºç¡€æ¨¡å‹ â€”â€” ä¸¤ä¸ªä¸åŒçš„å‘½åç©ºé—´é€šè¿‡ bridge é€šä¿¡ ã€‚
Docker é»˜è®¤çš„ bridge æ¨¡å¼å°±æ˜¯åŸºäºæ­¤åŸç†,åˆ›å»º docker0 bridgeï¼Œå®¹å™¨ veth å¯¹ä¸€ç«¯è¿æ¥å®¹å™¨ï¼Œä¸€ç«¯è¿æ¥ docker0ï¼Œæä¾› NAT åŠŸèƒ½è®©å®¹å™¨å¯ä»¥è®¿é—®å¤–ç½‘ã€‚
ä¸€ä¸ªç®€å•çš„ç»“æ„å¦‚ä¸‹ğŸ‘‡ï¼š
                      +---------------------+
                      |      root NS        |   (å®¿ä¸»æœº / default netns)
                      |  bridge: br0(10.0.0.254/24)
                      |                     |
                      |   veth0 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  |   <- veth0 åœ¨ rootï¼Œmaster=br0
                      |                  â”‚  |
                      |   veth2 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”˜  <- veth2 åœ¨ rootï¼Œmaster=br0
                      +---------------------+
                               â”‚
             â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
             â”‚                                   â”‚
       veth0 <-> veth1                       veth2 <-> veth3
  (root, peer)   (in ns1)                 (root, peer)   (in ns2)
                ns1 namespace                          ns2 namespace
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚ veth1         â”‚                     â”‚ veth3         â”‚
                â”‚ 10.0.0.1/24   â”‚                     â”‚ 10.0.0.2/24   â”‚
                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

            
    
      
        veth (Virtual Ethernet Device)
      
      
        è™šæ‹Ÿä»¥å¤ªç½‘è®¾å¤‡ï¼Œæ€»æ˜¯æˆå¯¹å‡ºç°ï¼Œç±»ä¼¼ç®¡é“ä¸¤ç«¯"><meta name=author content="Kerolt"><link rel=canonical href=https://kerolt.github.io/posts/net/linux%E4%B8%AD%E7%9A%84veth%E4%B8%8Ebridge/><meta name=google-site-verification content="NpIO0KEIJS0CPRzTzQCbYQdSRIyb0Lspx"><meta name=yandex-verification content="XYZabc"><meta name=msvalidate.01 content="2300A23B82DB579A2DEA6261191AD771"><link crossorigin=anonymous href=/assets/css/stylesheet.d199633e3c87808066c2e8bc9bd7e520533fc0913d70b4aad6819b793dd38bbe.css integrity="sha256-0ZljPjyHgIBmwui8m9flIFM/wJE9cLSq1oGbeT3Ti74=" rel="preload stylesheet" as=style><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/cn-fontsource-source-han-serif-sc-vf@1.0.9/font.min.css><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/lxgw-wenkai-screen-web/style.css><link rel=icon href=https://kerolt.github.io/images/avatar/favicon.png><link rel=icon type=image/png sizes=16x16 href=https://kerolt.github.io/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=32x32 href=https://kerolt.github.io/%3Clink%20/%20abs%20url%3E><link rel=apple-touch-icon href=https://kerolt.github.io/%3Clink%20/%20abs%20url%3E><link rel=mask-icon href=https://kerolt.github.io/%3Clink%20/%20abs%20url%3E><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://kerolt.github.io/posts/net/linux%E4%B8%AD%E7%9A%84veth%E4%B8%8Ebridge/><script src=https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js></script><link rel=stylesheet href=https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css><script src=https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js></script><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:url" content="https://kerolt.github.io/posts/net/linux%E4%B8%AD%E7%9A%84veth%E4%B8%8Ebridge/"><meta property="og:site_name" content="Kerolt's Blog"><meta property="og:title" content="Linuxä¸­çš„vethä¸bridge"><meta property="og:description" content="å®¹å™¨ç½‘ç»œæœ€å…¸å‹çš„åŸºç¡€æ¨¡å‹ â€”â€” ä¸¤ä¸ªä¸åŒçš„å‘½åç©ºé—´é€šè¿‡ bridge é€šä¿¡ ã€‚
Docker é»˜è®¤çš„ bridge æ¨¡å¼å°±æ˜¯åŸºäºæ­¤åŸç†,åˆ›å»º docker0 bridgeï¼Œå®¹å™¨ veth å¯¹ä¸€ç«¯è¿æ¥å®¹å™¨ï¼Œä¸€ç«¯è¿æ¥ docker0ï¼Œæä¾› NAT åŠŸèƒ½è®©å®¹å™¨å¯ä»¥è®¿é—®å¤–ç½‘ã€‚
ä¸€ä¸ªç®€å•çš„ç»“æ„å¦‚ä¸‹ğŸ‘‡ï¼š
+---------------------+ | root NS | (å®¿ä¸»æœº / default netns) | bridge: br0(10.0.0.254/24) | | | veth0 â”€â”€â”€â”€â”€â”€â”€â”€â”€â” | <- veth0 åœ¨ rootï¼Œmaster=br0 | â”‚ | | veth2 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”˜ <- veth2 åœ¨ rootï¼Œmaster=br0 +---------------------+ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚ veth0 <-> veth1 veth2 <-> veth3 (root, peer) (in ns1) (root, peer) (in ns2) ns1 namespace ns2 namespace â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ veth1 â”‚ â”‚ veth3 â”‚ â”‚ 10.0.0.1/24 â”‚ â”‚ 10.0.0.2/24 â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ veth (Virtual Ethernet Device) è™šæ‹Ÿä»¥å¤ªç½‘è®¾å¤‡ï¼Œæ€»æ˜¯æˆå¯¹å‡ºç°ï¼Œç±»ä¼¼ç®¡é“ä¸¤ç«¯"><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2025-11-08T00:00:00+00:00"><meta property="article:modified_time" content="2026-01-01T00:00:00+00:00"><meta property="article:tag" content="Veth"><meta property="article:tag" content="Bridge"><meta property="og:image" content="https://kerolt.github.io/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://kerolt.github.io/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta name=twitter:title content="Linuxä¸­çš„vethä¸bridge"><meta name=twitter:description content="å®¹å™¨ç½‘ç»œæœ€å…¸å‹çš„åŸºç¡€æ¨¡å‹ â€”â€” ä¸¤ä¸ªä¸åŒçš„å‘½åç©ºé—´é€šè¿‡ bridge é€šä¿¡ ã€‚
Docker é»˜è®¤çš„ bridge æ¨¡å¼å°±æ˜¯åŸºäºæ­¤åŸç†,åˆ›å»º docker0 bridgeï¼Œå®¹å™¨ veth å¯¹ä¸€ç«¯è¿æ¥å®¹å™¨ï¼Œä¸€ç«¯è¿æ¥ docker0ï¼Œæä¾› NAT åŠŸèƒ½è®©å®¹å™¨å¯ä»¥è®¿é—®å¤–ç½‘ã€‚
ä¸€ä¸ªç®€å•çš„ç»“æ„å¦‚ä¸‹ğŸ‘‡ï¼š
                      +---------------------+
                      |      root NS        |   (å®¿ä¸»æœº / default netns)
                      |  bridge: br0(10.0.0.254/24)
                      |                     |
                      |   veth0 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  |   <- veth0 åœ¨ rootï¼Œmaster=br0
                      |                  â”‚  |
                      |   veth2 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”˜  <- veth2 åœ¨ rootï¼Œmaster=br0
                      +---------------------+
                               â”‚
             â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
             â”‚                                   â”‚
       veth0 <-> veth1                       veth2 <-> veth3
  (root, peer)   (in ns1)                 (root, peer)   (in ns2)
                ns1 namespace                          ns2 namespace
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚ veth1         â”‚                     â”‚ veth3         â”‚
                â”‚ 10.0.0.1/24   â”‚                     â”‚ 10.0.0.2/24   â”‚
                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

            
    
      
        veth (Virtual Ethernet Device)
      
      
        è™šæ‹Ÿä»¥å¤ªç½‘è®¾å¤‡ï¼Œæ€»æ˜¯æˆå¯¹å‡ºç°ï¼Œç±»ä¼¼ç®¡é“ä¸¤ç«¯"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://kerolt.github.io/posts/"},{"@type":"ListItem","position":2,"name":"Linuxä¸­çš„vethä¸bridge","item":"https://kerolt.github.io/posts/net/linux%E4%B8%AD%E7%9A%84veth%E4%B8%8Ebridge/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Linuxä¸­çš„vethä¸bridge","name":"Linuxä¸­çš„vethä¸bridge","description":"å®¹å™¨ç½‘ç»œæœ€å…¸å‹çš„åŸºç¡€æ¨¡å‹ â€”â€” ä¸¤ä¸ªä¸åŒçš„å‘½åç©ºé—´é€šè¿‡ bridge é€šä¿¡ ã€‚\nDocker é»˜è®¤çš„ bridge æ¨¡å¼å°±æ˜¯åŸºäºæ­¤åŸç†,åˆ›å»º docker0 bridgeï¼Œå®¹å™¨ veth å¯¹ä¸€ç«¯è¿æ¥å®¹å™¨ï¼Œä¸€ç«¯è¿æ¥ docker0ï¼Œæä¾› NAT åŠŸèƒ½è®©å®¹å™¨å¯ä»¥è®¿é—®å¤–ç½‘ã€‚\nä¸€ä¸ªç®€å•çš„ç»“æ„å¦‚ä¸‹ğŸ‘‡ï¼š\n+---------------------+ | root NS | (å®¿ä¸»æœº / default netns) | bridge: br0(10.0.0.254/24) | | | veth0 â”€â”€â”€â”€â”€â”€â”€â”€â”€â” | \u0026lt;- veth0 åœ¨ rootï¼Œmaster=br0 | â”‚ | | veth2 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”˜ \u0026lt;- veth2 åœ¨ rootï¼Œmaster=br0 +---------------------+ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚ veth0 \u0026lt;-\u0026gt; veth1 veth2 \u0026lt;-\u0026gt; veth3 (root, peer) (in ns1) (root, peer) (in ns2) ns1 namespace ns2 namespace â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ veth1 â”‚ â”‚ veth3 â”‚ â”‚ 10.0.0.1/24 â”‚ â”‚ 10.0.0.2/24 â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ veth (Virtual Ethernet Device) è™šæ‹Ÿä»¥å¤ªç½‘è®¾å¤‡ï¼Œæ€»æ˜¯æˆå¯¹å‡ºç°ï¼Œç±»ä¼¼ç®¡é“ä¸¤ç«¯\n","keywords":["veth","bridge"],"articleBody":"å®¹å™¨ç½‘ç»œæœ€å…¸å‹çš„åŸºç¡€æ¨¡å‹ â€”â€” ä¸¤ä¸ªä¸åŒçš„å‘½åç©ºé—´é€šè¿‡ bridge é€šä¿¡ ã€‚\nDocker é»˜è®¤çš„ bridge æ¨¡å¼å°±æ˜¯åŸºäºæ­¤åŸç†,åˆ›å»º docker0 bridgeï¼Œå®¹å™¨ veth å¯¹ä¸€ç«¯è¿æ¥å®¹å™¨ï¼Œä¸€ç«¯è¿æ¥ docker0ï¼Œæä¾› NAT åŠŸèƒ½è®©å®¹å™¨å¯ä»¥è®¿é—®å¤–ç½‘ã€‚\nä¸€ä¸ªç®€å•çš„ç»“æ„å¦‚ä¸‹ğŸ‘‡ï¼š\n+---------------------+ | root NS | (å®¿ä¸»æœº / default netns) | bridge: br0(10.0.0.254/24) | | | veth0 â”€â”€â”€â”€â”€â”€â”€â”€â”€â” | \u003c- veth0 åœ¨ rootï¼Œmaster=br0 | â”‚ | | veth2 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”˜ \u003c- veth2 åœ¨ rootï¼Œmaster=br0 +---------------------+ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚ veth0 \u003c-\u003e veth1 veth2 \u003c-\u003e veth3 (root, peer) (in ns1) (root, peer) (in ns2) ns1 namespace ns2 namespace â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ veth1 â”‚ â”‚ veth3 â”‚ â”‚ 10.0.0.1/24 â”‚ â”‚ 10.0.0.2/24 â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ veth (Virtual Ethernet Device) è™šæ‹Ÿä»¥å¤ªç½‘è®¾å¤‡ï¼Œæ€»æ˜¯æˆå¯¹å‡ºç°ï¼Œç±»ä¼¼ç®¡é“ä¸¤ç«¯\nä¸€ç«¯å‘é€çš„æ•°æ®ä¼šåœ¨å¦ä¸€ç«¯æ¥æ”¶åˆ° ä¸»è¦ç”¨é€”ï¼šè¿æ¥ä¸åŒç½‘ç»œå‘½åç©ºé—´ï¼Œå®ç°ç½‘ç»œéš”ç¦»ç¯å¢ƒé—´çš„é€šä¿¡ bridge è™šæ‹Ÿäº¤æ¢æœºï¼Œå·¥ä½œåœ¨æ•°æ®é“¾è·¯å±‚ï¼ˆäºŒå±‚ï¼‰ å¯ä»¥è¿æ¥å¤šä¸ªç½‘ç»œæ¥å£ï¼Œåœ¨å®ƒä»¬ä¹‹é—´è½¬å‘æ•°æ®å¸§ Linux bridge æ”¯æŒ STPã€VLAN ç­‰äº¤æ¢æœºæ„é€ ç‰¹æ€§ ç½‘ç»œå‘½åç©ºé—´ (netns) æä¾›å®Œå…¨éš”ç¦»çš„ç½‘ç»œæ ˆï¼ŒåŒ…æ‹¬æ¥å£ã€è·¯ç”±è¡¨ã€iptables è§„åˆ™ç­‰ æ¯ä¸ªå®¹å™¨é€šå¸¸è¿è¡Œåœ¨ç‹¬ç«‹çš„ç½‘ç»œå‘½åç©ºé—´ä¸­ å®ç°æ­¥éª¤å¦‚ä¸‹ï¼š\nï¼ˆ1ï¼‰åˆ›å»ºä¸¤ä¸ªå‘½åç©ºé—´\nip netns add ns1 ip netns add ns2 ï¼ˆ2ï¼‰åˆ›å»ºä¸¤å¯¹ veth\næ¯ä¸ªå‘½åç©ºé—´å„åˆ†é…ä¸€ä¸ªç«¯å£ã€‚\nip link add veth0 type veth peer name veth1 ip link add veth2 type veth peer name veth3 ç°åœ¨æœ‰ï¼š\nveth0 \u003c-\u003e veth1 veth2 \u003c-\u003e veth3 ï¼ˆ3ï¼‰veth1 å’Œ veth3 ç§»å…¥å‘½åç©ºé—´\nip link set veth1 netns ns1 ip link set veth3 netns ns2 ï¼ˆ4ï¼‰åˆ›å»º bridgeï¼ˆè™šæ‹Ÿäº¤æ¢æœºï¼‰\nip link add name br0 type bridge ip link set br0 up ï¼ˆ5ï¼‰æŠŠå®¿ä¸»æœºä¾§çš„ vethï¼ˆveth0ã€veth2ï¼‰åŠ å…¥ bridge\nip link set veth0 master br0 ip link set veth2 master br0 ip link set veth0 up ip link set veth2 up ï¼ˆ6ï¼‰é…ç½®å‘½åç©ºé—´å†…éƒ¨ IP\nns1:\nip netns exec ns1 ip addr add 10.0.0.1/24 dev veth1 ip netns exec ns1 ip link set veth1 up ns2:\nip netns exec ns2 ip addr add 10.0.0.2/24 dev veth3 ip netns exec ns2 ip link set veth3 up æµ‹è¯•ä¸€ä¸‹è¿é€šæ€§ï¼š\nip netns exec ns1 ping 10.0.0.2 å¦‚æœä¸€åˆ‡æ­£å¸¸ï¼Œåº”è¯¥èƒ½ ping é€šï¼Œå› ä¸ºè¿™ä¸¤ä¸ª namespace çš„ \" ç½‘çº¿ \" éƒ½æ’åœ¨åŒä¸€ä¸ªè™šæ‹Ÿäº¤æ¢æœº br0 ä¸Šã€‚\nï¼ˆ7ï¼‰è®©å®¿ä¸»æœºä¹Ÿèƒ½å‚ä¸é€šä¿¡\nç»™å®¿ä¸»æœºä¹Ÿåˆ†é… ip åœ¨åŒä¸€ä¸ªç½‘æ®µï¼š\nip addr add 10.0.0.254/24 dev br0 ç„¶åï¼š\nip netns exec ns1 ping 10.0.0.254 ä¹Ÿèƒ½é€šã€‚è¿™æ ·ï¼Œé€šè¿‡ veth pair + bridge + netnsï¼Œå¯ä»¥æ¨¡æ‹Ÿ Docker é‚£æ ·æ˜¯å¦‚ä½•æ­å»ºä¸€ä¸ªå¤šå®¹å™¨è™šæ‹Ÿå±€åŸŸç½‘ã€‚\n","wordCount":"288","inLanguage":"en","image":"https://kerolt.github.io/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E","datePublished":"2025-11-08T00:00:00Z","dateModified":"2026-01-01T00:00:00Z","author":{"@type":"Person","name":"Kerolt"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://kerolt.github.io/posts/net/linux%E4%B8%AD%E7%9A%84veth%E4%B8%8Ebridge/"},"publisher":{"@type":"Organization","name":"Kerolt's Blog","logo":{"@type":"ImageObject","url":"https://kerolt.github.io/images/avatar/favicon.png"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://kerolt.github.io/ accesskey=h title="Kerolt's Blog (Alt + H)">Kerolt's Blog</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme">
<svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://kerolt.github.io/posts/ title=æ–‡ç« ><span>æ–‡ç« </span></a></li><li><a href=https://kerolt.github.io/categories/ title=åˆ†ç±»><span>åˆ†ç±»</span></a></li><li><a href=https://kerolt.github.io/tags/ title=æ ‡ç­¾><span>æ ‡ç­¾</span></a></li><li><a href=https://kerolt.github.io/archives/ title=å½’æ¡£><span>å½’æ¡£</span></a></li><li><a href=https://kerolt.github.io/about/ title=å…³äºæˆ‘><span>å…³äºæˆ‘</span></a></li><li><a href=https://kerolt.github.io/search/ title="ğŸ” (Alt + /)" accesskey=/><span>ğŸ”</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://kerolt.github.io/>Home</a>&nbsp;Â»&nbsp;<a href=https://kerolt.github.io/posts/>Posts</a></div><h1 class="post-title entry-hint-parent">Linuxä¸­çš„vethä¸bridge</h1><div class=post-meta><span title='2025-11-08 00:00:00 +0000 UTC'>å‘å¸ƒäº2025-11-08</span>&nbsp;&nbsp;Â·&nbsp;&nbsp;Kerolt</div><ul class=post-tags><li><a href=https://kerolt.github.io/tags/veth/>Veth</a></li><li><a href=https://kerolt.github.io/tags/bridge/>Bridge</a></li></ul></header><div class=post-content><p>å®¹å™¨ç½‘ç»œæœ€å…¸å‹çš„åŸºç¡€æ¨¡å‹ â€”â€” <strong>ä¸¤ä¸ªä¸åŒçš„å‘½åç©ºé—´é€šè¿‡ bridge é€šä¿¡</strong> ã€‚</p><p>Docker é»˜è®¤çš„ bridge æ¨¡å¼å°±æ˜¯åŸºäºæ­¤åŸç†,åˆ›å»º <code>docker0</code> bridgeï¼Œå®¹å™¨ veth å¯¹ä¸€ç«¯è¿æ¥å®¹å™¨ï¼Œä¸€ç«¯è¿æ¥ docker0ï¼Œæä¾› NAT åŠŸèƒ½è®©å®¹å™¨å¯ä»¥è®¿é—®å¤–ç½‘ã€‚</p><p>ä¸€ä¸ªç®€å•çš„ç»“æ„å¦‚ä¸‹ğŸ‘‡ï¼š</p><div class=highlight><pre tabindex=0 style=background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>                      +---------------------+
</span></span><span style=display:flex><span>                      |      root NS        |   <span style=color:#555>(</span>å®¿ä¸»æœº / default netns<span style=color:#555>)</span>
</span></span><span style=display:flex><span>                      |  bridge: br0<span style=color:#555>(</span>10.0.0.254/24<span style=color:#555>)</span>
</span></span><span style=display:flex><span>                      |                     |
</span></span><span style=display:flex><span>                      |   veth0 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  |   &lt;- veth0 åœ¨ rootï¼Œmaster<span style=color:#555>=</span>br0
</span></span><span style=display:flex><span>                      |                  â”‚  |
</span></span><span style=display:flex><span>                      |   veth2 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”˜  &lt;- veth2 åœ¨ rootï¼Œmaster<span style=color:#555>=</span>br0
</span></span><span style=display:flex><span>                      +---------------------+
</span></span><span style=display:flex><span>                               â”‚
</span></span><span style=display:flex><span>             â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
</span></span><span style=display:flex><span>             â”‚                                   â”‚
</span></span><span style=display:flex><span>       veth0 &lt;-&gt; veth1                       veth2 &lt;-&gt; veth3
</span></span><span style=display:flex><span>  <span style=color:#555>(</span>root, peer<span style=color:#555>)</span>   <span style=color:#555>(</span>in ns1<span style=color:#555>)</span>                 <span style=color:#555>(</span>root, peer<span style=color:#555>)</span>   <span style=color:#555>(</span>in ns2<span style=color:#555>)</span>
</span></span><span style=display:flex><span>                ns1 namespace                          ns2 namespace
</span></span><span style=display:flex><span>                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
</span></span><span style=display:flex><span>                â”‚ veth1         â”‚                     â”‚ veth3         â”‚
</span></span><span style=display:flex><span>                â”‚ 10.0.0.1/24   â”‚                     â”‚ 10.0.0.2/24   â”‚
</span></span><span style=display:flex><span>                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</span></span></code></pre></div><link rel=stylesheet href=/css/vendors/admonitions.4fd9a0b8ec8899f2ca952048d255a569f433f77dfb3f52f5bc87e7d65cdce449.css integrity="sha256-T9mguOyImfLKlSBI0lWlafQz9337P1L1vIfn1lzc5Ek=" crossorigin=anonymous><div class="admonition note"><div class=admonition-header><svg viewBox="0 0 576 512"><path d="M0 64C0 28.7 28.7.0 64 0H224v128c0 17.7 14.3 32 32 32h128v125.7l-86.8 86.8c-10.3 10.3-17.5 23.1-21 37.2l-18.7 74.9c-2.3 9.2-1.8 18.8 1.3 27.5L64 512c-35.3.0-64-28.7-64-64V64zm384 64H256V0L384 128zM549.8 235.7l14.4 14.4c15.6 15.6 15.6 40.9.0 56.6l-29.4 29.4-71-71 29.4-29.4c15.6-15.6 40.9-15.6 56.6.0zM311.9 417 441.1 287.8l71 71L382.9 487.9c-4.1 4.1-9.2 7-14.9 8.4l-60.1 15c-5.5 1.4-11.2-.2-15.2-4.2s-5.6-9.7-4.2-15.2l15-60.1c1.4-5.6 4.3-10.8 8.4-14.9z"/></svg>
<span>veth (Virtual Ethernet Device)</span></div><div class=admonition-content><p>è™šæ‹Ÿä»¥å¤ªç½‘è®¾å¤‡ï¼Œæ€»æ˜¯æˆå¯¹å‡ºç°ï¼Œç±»ä¼¼ç®¡é“ä¸¤ç«¯</p><ul><li>ä¸€ç«¯å‘é€çš„æ•°æ®ä¼šåœ¨å¦ä¸€ç«¯æ¥æ”¶åˆ°</li><li>ä¸»è¦ç”¨é€”ï¼šè¿æ¥ä¸åŒç½‘ç»œå‘½åç©ºé—´ï¼Œå®ç°ç½‘ç»œéš”ç¦»ç¯å¢ƒé—´çš„é€šä¿¡</li></ul></div></div><div class="admonition note"><div class=admonition-header><svg viewBox="0 0 576 512"><path d="M0 64C0 28.7 28.7.0 64 0H224v128c0 17.7 14.3 32 32 32h128v125.7l-86.8 86.8c-10.3 10.3-17.5 23.1-21 37.2l-18.7 74.9c-2.3 9.2-1.8 18.8 1.3 27.5L64 512c-35.3.0-64-28.7-64-64V64zm384 64H256V0L384 128zM549.8 235.7l14.4 14.4c15.6 15.6 15.6 40.9.0 56.6l-29.4 29.4-71-71 29.4-29.4c15.6-15.6 40.9-15.6 56.6.0zM311.9 417 441.1 287.8l71 71L382.9 487.9c-4.1 4.1-9.2 7-14.9 8.4l-60.1 15c-5.5 1.4-11.2-.2-15.2-4.2s-5.6-9.7-4.2-15.2l15-60.1c1.4-5.6 4.3-10.8 8.4-14.9z"/></svg>
<span>bridge</span></div><div class=admonition-content><ul><li>è™šæ‹Ÿäº¤æ¢æœºï¼Œå·¥ä½œåœ¨æ•°æ®é“¾è·¯å±‚ï¼ˆäºŒå±‚ï¼‰</li><li>å¯ä»¥è¿æ¥å¤šä¸ªç½‘ç»œæ¥å£ï¼Œåœ¨å®ƒä»¬ä¹‹é—´è½¬å‘æ•°æ®å¸§</li><li>Linux bridge æ”¯æŒ STPã€VLAN ç­‰äº¤æ¢æœºæ„é€ ç‰¹æ€§</li></ul></div></div><div class="admonition note"><div class=admonition-header><svg viewBox="0 0 576 512"><path d="M0 64C0 28.7 28.7.0 64 0H224v128c0 17.7 14.3 32 32 32h128v125.7l-86.8 86.8c-10.3 10.3-17.5 23.1-21 37.2l-18.7 74.9c-2.3 9.2-1.8 18.8 1.3 27.5L64 512c-35.3.0-64-28.7-64-64V64zm384 64H256V0L384 128zM549.8 235.7l14.4 14.4c15.6 15.6 15.6 40.9.0 56.6l-29.4 29.4-71-71 29.4-29.4c15.6-15.6 40.9-15.6 56.6.0zM311.9 417 441.1 287.8l71 71L382.9 487.9c-4.1 4.1-9.2 7-14.9 8.4l-60.1 15c-5.5 1.4-11.2-.2-15.2-4.2s-5.6-9.7-4.2-15.2l15-60.1c1.4-5.6 4.3-10.8 8.4-14.9z"/></svg>
<span>ç½‘ç»œå‘½åç©ºé—´ (netns)</span></div><div class=admonition-content><ul><li>æä¾›å®Œå…¨éš”ç¦»çš„ç½‘ç»œæ ˆï¼ŒåŒ…æ‹¬æ¥å£ã€è·¯ç”±è¡¨ã€iptables è§„åˆ™ç­‰</li><li>æ¯ä¸ªå®¹å™¨é€šå¸¸è¿è¡Œåœ¨ç‹¬ç«‹çš„ç½‘ç»œå‘½åç©ºé—´ä¸­</li></ul></div></div><p>å®ç°æ­¥éª¤å¦‚ä¸‹ï¼š</p><p><strong>ï¼ˆ1ï¼‰åˆ›å»ºä¸¤ä¸ªå‘½åç©ºé—´</strong></p><div class=highlight><pre tabindex=0 style=background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>ip netns add ns1
</span></span><span style=display:flex><span>ip netns add ns2
</span></span></code></pre></div><p><strong>ï¼ˆ2ï¼‰åˆ›å»ºä¸¤å¯¹ veth</strong></p><p>æ¯ä¸ªå‘½åç©ºé—´å„åˆ†é…ä¸€ä¸ªç«¯å£ã€‚</p><div class=highlight><pre tabindex=0 style=background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>ip link add veth0 <span style=color:#366>type</span> veth peer name veth1
</span></span><span style=display:flex><span>ip link add veth2 <span style=color:#366>type</span> veth peer name veth3
</span></span></code></pre></div><p>ç°åœ¨æœ‰ï¼š</p><div class=highlight><pre tabindex=0 style=background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>veth0 &lt;-&gt; veth1
</span></span><span style=display:flex><span>veth2 &lt;-&gt; veth3
</span></span></code></pre></div><p><strong>ï¼ˆ3ï¼‰veth1 å’Œ veth3 ç§»å…¥å‘½åç©ºé—´</strong></p><div class=highlight><pre tabindex=0 style=background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>ip link <span style=color:#366>set</span> veth1 netns ns1
</span></span><span style=display:flex><span>ip link <span style=color:#366>set</span> veth3 netns ns2
</span></span></code></pre></div><p><strong>ï¼ˆ4ï¼‰åˆ›å»º bridgeï¼ˆè™šæ‹Ÿäº¤æ¢æœºï¼‰</strong></p><div class=highlight><pre tabindex=0 style=background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>ip link add name br0 <span style=color:#366>type</span> bridge
</span></span><span style=display:flex><span>ip link <span style=color:#366>set</span> br0 up
</span></span></code></pre></div><p><strong>ï¼ˆ5ï¼‰æŠŠå®¿ä¸»æœºä¾§çš„ vethï¼ˆveth0ã€veth2ï¼‰åŠ å…¥ bridge</strong></p><div class=highlight><pre tabindex=0 style=background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>ip link <span style=color:#366>set</span> veth0 master br0
</span></span><span style=display:flex><span>ip link <span style=color:#366>set</span> veth2 master br0
</span></span><span style=display:flex><span>ip link <span style=color:#366>set</span> veth0 up
</span></span><span style=display:flex><span>ip link <span style=color:#366>set</span> veth2 up
</span></span></code></pre></div><p><strong>ï¼ˆ6ï¼‰é…ç½®å‘½åç©ºé—´å†…éƒ¨ IP</strong></p><p><strong>ns1</strong>:</p><div class=highlight><pre tabindex=0 style=background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>ip netns <span style=color:#366>exec</span> ns1 ip addr add 10.0.0.1/24 dev veth1
</span></span><span style=display:flex><span>ip netns <span style=color:#366>exec</span> ns1 ip link <span style=color:#366>set</span> veth1 up
</span></span></code></pre></div><p><strong>ns2</strong>:</p><div class=highlight><pre tabindex=0 style=background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>ip netns <span style=color:#366>exec</span> ns2 ip addr add 10.0.0.2/24 dev veth3
</span></span><span style=display:flex><span>ip netns <span style=color:#366>exec</span> ns2 ip link <span style=color:#366>set</span> veth3 up
</span></span></code></pre></div><p>æµ‹è¯•ä¸€ä¸‹è¿é€šæ€§ï¼š</p><div class=highlight><pre tabindex=0 style=background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>ip netns <span style=color:#366>exec</span> ns1 ping 10.0.0.2
</span></span></code></pre></div><p>å¦‚æœä¸€åˆ‡æ­£å¸¸ï¼Œåº”è¯¥èƒ½ ping é€šï¼Œå› ä¸ºè¿™ä¸¤ä¸ª namespace çš„ " ç½‘çº¿ " éƒ½æ’åœ¨åŒä¸€ä¸ªè™šæ‹Ÿäº¤æ¢æœº <code>br0</code> ä¸Šã€‚</p><p><strong>ï¼ˆ7ï¼‰è®©å®¿ä¸»æœºä¹Ÿèƒ½å‚ä¸é€šä¿¡</strong></p><p>ç»™å®¿ä¸»æœºä¹Ÿåˆ†é… ip åœ¨åŒä¸€ä¸ªç½‘æ®µï¼š</p><div class=highlight><pre tabindex=0 style=background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>ip addr add 10.0.0.254/24 dev br0
</span></span></code></pre></div><p>ç„¶åï¼š</p><div class=highlight><pre tabindex=0 style=background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>ip netns <span style=color:#366>exec</span> ns1 ping 10.0.0.254
</span></span></code></pre></div><p>ä¹Ÿèƒ½é€šã€‚è¿™æ ·ï¼Œé€šè¿‡ <code>veth pair</code> + <code>bridge</code> + <code>netns</code>ï¼Œå¯ä»¥æ¨¡æ‹Ÿ Docker é‚£æ ·æ˜¯å¦‚ä½•æ­å»ºä¸€ä¸ªå¤šå®¹å™¨è™šæ‹Ÿå±€åŸŸç½‘ã€‚</p></div><footer class=post-footer><nav class=paginav><a class=prev href=https://kerolt.github.io/posts/net/linux%E4%BF%AE%E6%94%B9ip/><span class=title>Â« Prev</span><br><span>Linuxä¿®æ”¹IP</span>
</a><a class=next href=https://kerolt.github.io/posts/linux/linux%E6%A0%A1%E5%87%86%E6%97%B6%E9%97%B4/><span class=title>Next Â»</span><br><span>Linuxæ ¡å‡†æ—¶é—´</span></a></nav></footer></article></main><footer class=footer><span>&copy; 2026 <a href=https://kerolt.github.io/>Kerolt's Blog</a></span> Â·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
<a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentColor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>