<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>ã€MIT6.S081ã€‘Lab2 system calls | Kerolt's Blog</title>
<meta name=keywords content="OS,MIT6-S081"><meta name=description content="å‰è¨€
è¿™ä¸ªlabå¼€å§‹æˆ‘ä»¬å°±æ­£å¼è¿›å…¥äº†xv6çš„ä¸–ç•Œäº†ï¼Œè¿™ä¸€æ¬¡æˆ‘ä»¬å¯ä»¥äº†è§£åˆ°å†…æ ¸ä¸­ç³»ç»Ÿè°ƒç”¨çš„æ³¨å†Œå’Œè¿è¡ŒåŸç†ï¼Œè¿™å¯ä»¥è¯´æ˜¯ä¹‹ålabçš„ä¸€ä¸ªåŸºçŸ³ã€‚"><meta name=author content="Kerolt"><link rel=canonical href=https://kerolt.github.io/posts/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/mit6.s081lab2-system-calls/><meta name=google-site-verification content="XYZabc"><meta name=yandex-verification content="XYZabc"><meta name=msvalidate.01 content="XYZabc"><link crossorigin=anonymous href=/assets/css/stylesheet.035011695ba11fe36df35b8148f02b5baa41b9707b8d79a5a7d00fb4e65cc340.css integrity="sha256-A1ARaVuhH+Nt81uBSPArW6pBuXB7jXmlp9APtOZcw0A=" rel="preload stylesheet" as=style><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/lxgw-wenkai-screen-web/style.css><link rel=icon href=https://kerolt.github.io/images/avatar/favicon.png><link rel=icon type=image/png sizes=16x16 href=https://kerolt.github.io/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=32x32 href=https://kerolt.github.io/%3Clink%20/%20abs%20url%3E><link rel=apple-touch-icon href=https://kerolt.github.io/%3Clink%20/%20abs%20url%3E><link rel=mask-icon href=https://kerolt.github.io/%3Clink%20/%20abs%20url%3E><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://kerolt.github.io/posts/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/mit6.s081lab2-system-calls/><script src=https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js></script><link rel=stylesheet href=https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css><script src=https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js></script><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:url" content="https://kerolt.github.io/posts/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/mit6.s081lab2-system-calls/"><meta property="og:site_name" content="Kerolt's Blog"><meta property="og:title" content="ã€MIT6.S081ã€‘Lab2 system calls"><meta property="og:description" content="å‰è¨€ è¿™ä¸ªlabå¼€å§‹æˆ‘ä»¬å°±æ­£å¼è¿›å…¥äº†xv6çš„ä¸–ç•Œäº†ï¼Œè¿™ä¸€æ¬¡æˆ‘ä»¬å¯ä»¥äº†è§£åˆ°å†…æ ¸ä¸­ç³»ç»Ÿè°ƒç”¨çš„æ³¨å†Œå’Œè¿è¡ŒåŸç†ï¼Œè¿™å¯ä»¥è¯´æ˜¯ä¹‹ålabçš„ä¸€ä¸ªåŸºçŸ³ã€‚"><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-10-28T00:00:00+00:00"><meta property="article:modified_time" content="2024-10-28T00:00:00+00:00"><meta property="article:tag" content="OS"><meta property="article:tag" content="MIT6-S081"><meta property="og:image" content="https://kerolt.github.io/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://kerolt.github.io/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta name=twitter:title content="ã€MIT6.S081ã€‘Lab2 system calls"><meta name=twitter:description content="å‰è¨€
è¿™ä¸ªlabå¼€å§‹æˆ‘ä»¬å°±æ­£å¼è¿›å…¥äº†xv6çš„ä¸–ç•Œäº†ï¼Œè¿™ä¸€æ¬¡æˆ‘ä»¬å¯ä»¥äº†è§£åˆ°å†…æ ¸ä¸­ç³»ç»Ÿè°ƒç”¨çš„æ³¨å†Œå’Œè¿è¡ŒåŸç†ï¼Œè¿™å¯ä»¥è¯´æ˜¯ä¹‹ålabçš„ä¸€ä¸ªåŸºçŸ³ã€‚"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://kerolt.github.io/posts/"},{"@type":"ListItem","position":2,"name":"ã€MIT6.S081ã€‘Lab2 system calls","item":"https://kerolt.github.io/posts/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/mit6.s081lab2-system-calls/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"ã€MIT6.S081ã€‘Lab2 system calls","name":"ã€MIT6.S081ã€‘Lab2 system calls","description":"å‰è¨€ è¿™ä¸ªlabå¼€å§‹æˆ‘ä»¬å°±æ­£å¼è¿›å…¥äº†xv6çš„ä¸–ç•Œäº†ï¼Œè¿™ä¸€æ¬¡æˆ‘ä»¬å¯ä»¥äº†è§£åˆ°å†…æ ¸ä¸­ç³»ç»Ÿè°ƒç”¨çš„æ³¨å†Œå’Œè¿è¡ŒåŸç†ï¼Œè¿™å¯ä»¥è¯´æ˜¯ä¹‹ålabçš„ä¸€ä¸ªåŸºçŸ³ã€‚\n","keywords":["OS","MIT6-S081"],"articleBody":"å‰è¨€ è¿™ä¸ªlabå¼€å§‹æˆ‘ä»¬å°±æ­£å¼è¿›å…¥äº†xv6çš„ä¸–ç•Œäº†ï¼Œè¿™ä¸€æ¬¡æˆ‘ä»¬å¯ä»¥äº†è§£åˆ°å†…æ ¸ä¸­ç³»ç»Ÿè°ƒç”¨çš„æ³¨å†Œå’Œè¿è¡ŒåŸç†ï¼Œè¿™å¯ä»¥è¯´æ˜¯ä¹‹ålabçš„ä¸€ä¸ªåŸºçŸ³ã€‚\ntrace é¦–å…ˆï¼Œæˆ‘ä»¬è¦æ¸…æ¥šè¿™ä¸ªå®éªŒçš„ç›®çš„æ˜¯ä»€ä¹ˆï¼š\nIn this assignment you will add a system call tracing feature that may help you when debugging later labs. Youâ€™ll create a newÂ traceÂ system call that will control tracing. It should take one argument, an integer â€œmaskâ€, whose bits specify which system calls to trace. For example, to trace the fork system call, a program callsÂ trace(1 Â« SYS_fork), whereÂ SYS_forkÂ is a syscall number fromÂ kernel/syscall.h. You have to modify the xv6 kernel to print out a line when each system call is about to return, if the system callâ€™s number is set in the mask. The line should contain the process id, the name of the system call and the return value; you donâ€™t need to print the system call arguments. TheÂ traceÂ system call should enable tracing for the process that calls it and any children that it subsequently forks, but should not affect other processes.\nè¯‘ï¼šåœ¨Xv6çš„traceå‘½ä»¤ä¸­ï¼Œå®ƒåº”è¯¥æœ‰ä¸€ä¸ªå‚æ•°ï¼Œä¸€ä¸ªæ•´æ•°â€œæ©ç â€ï¼Œå…¶ä½æŒ‡å®šè¦è·Ÿè¸ªçš„ç³»ç»Ÿè°ƒç”¨ã€‚ä¾‹å¦‚ï¼Œè¦è·Ÿè¸ªforkç³»ç»Ÿè°ƒç”¨ï¼Œç¨‹åºè°ƒç”¨trace(1\u003c","wordCount":"1195","inLanguage":"en","image":"https://kerolt.github.io/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E","datePublished":"2024-10-28T00:00:00Z","dateModified":"2024-10-28T00:00:00Z","author":{"@type":"Person","name":"Kerolt"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://kerolt.github.io/posts/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/mit6.s081lab2-system-calls/"},"publisher":{"@type":"Organization","name":"Kerolt's Blog","logo":{"@type":"ImageObject","url":"https://kerolt.github.io/images/avatar/favicon.png"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://kerolt.github.io/ accesskey=h title="Kerolt's Blog (Alt + H)">Kerolt's Blog</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://kerolt.github.io/posts/ title=æ–‡ç« ><span>æ–‡ç« </span></a></li><li><a href=https://kerolt.github.io/categories/ title=åˆ†ç±»><span>åˆ†ç±»</span></a></li><li><a href=https://kerolt.github.io/tags/ title=æ ‡ç­¾><span>æ ‡ç­¾</span></a></li><li><a href=https://kerolt.github.io/archives/ title=å½’æ¡£><span>å½’æ¡£</span></a></li><li><a href=https://kerolt.github.io/about/ title=å…³äºæˆ‘><span>å…³äºæˆ‘</span></a></li><li><a href=https://kerolt.github.io/search/ title="ğŸ” (Alt + /)" accesskey=/><span>ğŸ”</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://kerolt.github.io/>Home</a>&nbsp;Â»&nbsp;<a href=https://kerolt.github.io/posts/>Posts</a></div><h1 class="post-title entry-hint-parent">ã€MIT6.S081ã€‘Lab2 system calls</h1><div class=post-meta><span title='2024-10-28 00:00:00 +0000 UTC'>2024-10-28</span>&nbsp;Â·&nbsp;6 min&nbsp;Â·&nbsp;1195 words&nbsp;Â·&nbsp;Kerolt</div><ul class=post-tags><li><a href=https://kerolt.github.io/tags/os/>OS</a></li><li><a href=https://kerolt.github.io/tags/mit6-s081/>MIT6-S081</a></li></ul></header><aside id=toc-container class="toc-container wide"><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#%e5%89%8d%e8%a8%80 aria-label=å‰è¨€>å‰è¨€</a></li><li><a href=#trace aria-label=trace>trace</a><ul><li><a href=#mask%e6%98%af%e4%bb%80%e4%b9%88 aria-label=maskæ˜¯ä»€ä¹ˆï¼Ÿ>maskæ˜¯ä»€ä¹ˆï¼Ÿ</a></li><li><a href=#%e8%bf%9b%e7%a8%8b%e5%8f%8a%e5%85%b6%e5%ad%90%e8%bf%9b%e7%a8%8b%e5%a6%82%e4%bd%95%e8%8e%b7%e5%8f%96mask aria-label=è¿›ç¨‹åŠå…¶å­è¿›ç¨‹å¦‚ä½•è·å–maskï¼Ÿ>è¿›ç¨‹åŠå…¶å­è¿›ç¨‹å¦‚ä½•è·å–maskï¼Ÿ</a></li><li><a href=#%e5%a6%82%e4%bd%95%e8%b7%9f%e8%b8%aa%e7%b3%bb%e7%bb%9f%e8%b0%83%e7%94%a8 aria-label=å¦‚ä½•è·Ÿè¸ªç³»ç»Ÿè°ƒç”¨ï¼Ÿ>å¦‚ä½•è·Ÿè¸ªç³»ç»Ÿè°ƒç”¨ï¼Ÿ</a></li></ul></li><li><a href=#sysinfo aria-label=sysinfo>sysinfo</a><ul><li><a href=#%e8%ae%a1%e7%ae%97%e5%8f%af%e7%94%a8%e5%86%85%e5%ad%98%e5%ad%97%e8%8a%82%e6%95%b0 aria-label=è®¡ç®—å¯ç”¨å†…å­˜å­—èŠ‚æ•°>è®¡ç®—å¯ç”¨å†…å­˜å­—èŠ‚æ•°</a></li><li><a href=#%e8%ae%a1%e7%ae%97%e7%8a%b6%e6%80%81%e4%b8%ba%e6%9c%aa%e4%b8%ba%e4%bd%bf%e7%94%a8%e8%bf%9b%e7%a8%8b%e6%95%b0 aria-label=è®¡ç®—çŠ¶æ€ä¸ºæœªä¸ºä½¿ç”¨è¿›ç¨‹æ•°>è®¡ç®—çŠ¶æ€ä¸ºæœªä¸ºä½¿ç”¨è¿›ç¨‹æ•°</a></li><li><a href=#%e5%ae%8c%e6%88%90%e7%b3%bb%e7%bb%9f%e8%b0%83%e7%94%a8 aria-label=å®Œæˆç³»ç»Ÿè°ƒç”¨>å®Œæˆç³»ç»Ÿè°ƒç”¨</a></li></ul></li></ul></div></details></div></aside><script>let activeElement,elements;window.addEventListener("DOMContentLoaded",function(){checkTocPosition(),elements=document.querySelectorAll("h1[id],h2[id],h3[id],h4[id],h5[id],h6[id]"),activeElement=elements[0];const t=encodeURI(activeElement.getAttribute("id")).toLowerCase();document.querySelector(`.inner ul li a[href="#${t}"]`).classList.add("active")},!1),window.addEventListener("resize",function(){checkTocPosition()},!1),window.addEventListener("scroll",()=>{activeElement=Array.from(elements).find(e=>{if(getOffsetTop(e)-window.pageYOffset>0&&getOffsetTop(e)-window.pageYOffset<window.innerHeight/2)return e})||activeElement,elements.forEach(e=>{const t=encodeURI(e.getAttribute("id")).toLowerCase();e===activeElement?document.querySelector(`.inner ul li a[href="#${t}"]`).classList.add("active"):document.querySelector(`.inner ul li a[href="#${t}"]`).classList.remove("active")})},!1);const main=parseInt(getComputedStyle(document.body).getPropertyValue("--article-width"),10),toc=parseInt(getComputedStyle(document.body).getPropertyValue("--toc-width"),10),gap=parseInt(getComputedStyle(document.body).getPropertyValue("--gap"),10);function checkTocPosition(){const e=document.body.scrollWidth;e-main-toc*2-gap*4>0?document.getElementById("toc-container").classList.add("wide"):document.getElementById("toc-container").classList.remove("wide")}function getOffsetTop(e){if(!e.getClientRects().length)return 0;let t=e.getBoundingClientRect(),n=e.ownerDocument.defaultView;return t.top+n.pageYOffset}</script><div class=post-content><h2 id=å‰è¨€>å‰è¨€<a hidden class=anchor aria-hidden=true href=#å‰è¨€>#</a></h2><p>è¿™ä¸ªlabå¼€å§‹æˆ‘ä»¬å°±æ­£å¼è¿›å…¥äº†xv6çš„ä¸–ç•Œäº†ï¼Œè¿™ä¸€æ¬¡æˆ‘ä»¬å¯ä»¥äº†è§£åˆ°å†…æ ¸ä¸­ç³»ç»Ÿè°ƒç”¨çš„æ³¨å†Œå’Œè¿è¡ŒåŸç†ï¼Œè¿™å¯ä»¥è¯´æ˜¯ä¹‹ålabçš„ä¸€ä¸ªåŸºçŸ³ã€‚</p><h2 id=trace>trace<a hidden class=anchor aria-hidden=true href=#trace>#</a></h2><p>é¦–å…ˆï¼Œæˆ‘ä»¬è¦æ¸…æ¥šè¿™ä¸ªå®éªŒçš„ç›®çš„æ˜¯ä»€ä¹ˆï¼š</p><blockquote><p>In this assignment you will add a system call tracing feature that may help you when debugging later labs. You&rsquo;ll create a newÂ traceÂ system call that will control tracing. It should take one argument, an integer &ldquo;mask&rdquo;, whose bits specify which system calls to trace. For example, to trace the fork system call, a program callsÂ trace(1 &#171; SYS_fork), whereÂ SYS_forkÂ is a syscall number fromÂ kernel/syscall.h. You have to modify the xv6 kernel to print out a line when each system call is about to return, if the system call&rsquo;s number is set in the mask. The line should contain the process id, the name of the system call and the return value; you don&rsquo;t need to print the system call arguments. TheÂ traceÂ system call should enable tracing for the process that calls it and any children that it subsequently forks, but should not affect other processes.</p></blockquote><p>è¯‘ï¼šåœ¨Xv6çš„traceå‘½ä»¤ä¸­ï¼Œå®ƒåº”è¯¥æœ‰ä¸€ä¸ªå‚æ•°ï¼Œä¸€ä¸ªæ•´æ•°â€œæ©ç â€ï¼Œå…¶ä½æŒ‡å®šè¦è·Ÿè¸ªçš„ç³»ç»Ÿè°ƒç”¨ã€‚ä¾‹å¦‚ï¼Œè¦è·Ÿè¸ªforkç³»ç»Ÿè°ƒç”¨ï¼Œç¨‹åºè°ƒç”¨<code>trace(1&lt;&lt;SYS_fork)</code>ï¼Œå…¶ä¸­SYS_forkæ˜¯<code>kernel/syscall.h</code>ä¸­çš„ç³»ç»Ÿè°ƒç”¨ç¼–å·ã€‚å¦‚æœç³»ç»Ÿè°ƒç”¨çš„ç¼–å·åœ¨æ©ç ä¸­è®¾ç½®ï¼Œåˆ™å¿…é¡»ä¿®æ”¹xv6å†…æ ¸ï¼Œä»¥ä¾¿åœ¨æ¯ä¸ªç³»ç»Ÿè°ƒç”¨å³å°†è¿”å›æ—¶æ‰“å°å‡ºä¸€è¡Œã€‚è¯¥è¡Œåº”åŒ…å«<strong>è¿›ç¨‹id</strong>ã€<strong>ç³»ç»Ÿè°ƒç”¨çš„åç§°</strong>å’Œ<strong>è¿”å›å€¼</strong>ï¼›æ‚¨ä¸éœ€è¦æ‰“å°ç³»ç»Ÿè°ƒç”¨å‚æ•°ã€‚è·Ÿè¸ªç³»ç»Ÿè°ƒç”¨åº”å¯ç”¨å¯¹è°ƒç”¨å®ƒçš„è¿›ç¨‹åŠå…¶éšååˆ†å‰çš„ä»»ä½•<strong>å­è¿›ç¨‹</strong>çš„è·Ÿè¸ªï¼Œä½†ä¸åº”å½±å“å…¶ä»–è¿›ç¨‹ã€‚</p><p>æ³¨æ„ï¼Œåœ¨è¯¥å®éªŒçš„åˆå§‹é˜¶æ®µï¼Œxv6å·²ç»ä¸ºæˆ‘ä»¬æä¾›äº†traceå‘½ä»¤çš„ç”¨æˆ·æ€å®ç°ï¼Œä½†æ˜¯å…¶åº•å±‚çš„ç³»ç»Ÿè°ƒç”¨éœ€è¦æˆ‘ä»¬è‡ªå·±å®ç°ã€‚</p><h3 id=maskæ˜¯ä»€ä¹ˆ>maskæ˜¯ä»€ä¹ˆï¼Ÿ<a hidden class=anchor aria-hidden=true href=#maskæ˜¯ä»€ä¹ˆ>#</a></h3><p>åœ¨ä½¿ç”¨traceå‘½ä»¤æ—¶ç”¨åˆ°çš„æ©ç ï¼Œæ˜¯ç”¨æ¥è·Ÿè¸ªä¹‹åä½¿ç”¨çš„å‘½ä»¤ç”¨åˆ°äº†å“ªäº›ç³»ç»Ÿè°ƒç”¨ã€‚ä¾‹å¦‚å®éªŒä¸­ç»™å‡ºçš„ä¾‹å­ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ trace <span class=m>32</span> grep hello README
</span></span><span class=line><span class=cl>3: syscall <span class=nb>read</span> -&gt; <span class=m>1023</span>
</span></span><span class=line><span class=cl>3: syscall <span class=nb>read</span> -&gt; <span class=m>966</span>
</span></span><span class=line><span class=cl>3: syscall <span class=nb>read</span> -&gt; <span class=m>70</span>
</span></span><span class=line><span class=cl>3: syscall <span class=nb>read</span> -&gt; <span class=m>0</span>
</span></span></code></pre></div><p>è¿™ä¸ª32å°±æ˜¯æ©ç ï¼Œå…¶è·Ÿè¸ªåˆ°äº†grepå‘½ä»¤ä¸­ä½¿ç”¨åˆ°äº†readç³»ç»Ÿè°ƒç”¨ï¼ˆä¸ºä»€ä¹ˆæ˜¯readï¼Ÿé©¬ä¸Šå°±è¯´åˆ°äº†ï¼‰ã€‚åœ¨xv6çš„<code>kernel/syscall.h</code>ä¸­æœ‰æ‰€æœ‰ç³»ç»Ÿè°ƒç”¨çš„ç¼–å·ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=c1>// System call numbers
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=cp>#define SYS_fork    1
</span></span></span><span class=line><span class=cl><span class=cp>#define SYS_exit    2
</span></span></span><span class=line><span class=cl><span class=cp>#define SYS_wait    3
</span></span></span><span class=line><span class=cl><span class=cp>#define SYS_pipe    4
</span></span></span><span class=line><span class=cl><span class=cp>#define SYS_read    5
</span></span></span><span class=line><span class=cl><span class=cp>#define SYS_kill    6
</span></span></span><span class=line><span class=cl><span class=cp>#define SYS_exec    7
</span></span></span><span class=line><span class=cl><span class=cp>#define SYS_fstat   8
</span></span></span><span class=line><span class=cl><span class=cp>#define SYS_chdir   9
</span></span></span><span class=line><span class=cl><span class=cp>#define SYS_dup    10
</span></span></span><span class=line><span class=cl><span class=cp>#define SYS_getpid 11
</span></span></span><span class=line><span class=cl><span class=cp>#define SYS_sbrk   12
</span></span></span><span class=line><span class=cl><span class=cp>#define SYS_sleep  13
</span></span></span><span class=line><span class=cl><span class=cp>#define SYS_uptime 14
</span></span></span><span class=line><span class=cl><span class=cp>#define SYS_open   15
</span></span></span><span class=line><span class=cl><span class=cp>#define SYS_write  16
</span></span></span><span class=line><span class=cl><span class=cp>#define SYS_mknod  17
</span></span></span><span class=line><span class=cl><span class=cp>#define SYS_unlink 18
</span></span></span><span class=line><span class=cl><span class=cp>#define SYS_link   19
</span></span></span><span class=line><span class=cl><span class=cp>#define SYS_mkdir  20
</span></span></span><span class=line><span class=cl><span class=cp>#define SYS_close  21
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=c1>// æ·»åŠ 
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=cp>#define SYS_trace  22 
</span></span></span></code></pre></div><p>å°†è¿™ä¸ªmaskä»¥äºŒè¿›åˆ¶çš„å½¢å¼æ¥çœ‹å¾…æ›´åŠ å®¹æ˜“ç†è§£ï¼Œå¦‚æœä¼ å…¥çš„maskæ˜¯32ï¼Œé‚£ä¹ˆå…¶äºŒè¿›åˆ¶ä¸º100000ï¼Œè¿™ä¸ª1å‡ºç°çš„ä½ç½®æ˜¯ç¬¬5ä½ï¼ˆæœ€ä½ä½æŒ‰0è®¡æ•°ï¼‰ï¼Œä¹Ÿå°±æ˜¯å»æ‰¾ç¼–å·ä¸º5çš„ç³»ç»Ÿè°ƒç”¨ï¼Œä¹Ÿå°±æ˜¯<code>SYS_read</code>ã€‚</p><p>xv6å†…æ ¸æä¾›ç»™ç”¨æˆ·æ€çš„æ¥å£ä¸ºtraceï¼Œä½†æ˜¯æˆ‘ä»¬éœ€è¦è‡ªå·±<strong>åœ¨xv6çš„ç”¨æˆ·å¤´æ–‡ä»¶ä¸­æ·»åŠ å‡½æ•°çš„å£°æ˜</strong>ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=c1>// user/user.h
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>trace</span><span class=p>(</span><span class=kt>int</span><span class=p>);</span> 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// ...
</span></span></span></code></pre></div><p>è¿™ä¸ªtraceåº•å±‚å…¶å®è°ƒç”¨çš„åº”è¯¥æ˜¯sys_traceï¼ˆè¿™ä¸ªå‡½æ•°åä¸æ˜¯å›ºå®šçš„ï¼Œä½†æ˜¯æºç ä¸­å…¶ä»–çš„ç³»ç»Ÿè°ƒç”¨çš„å‘½åéƒ½ä¸ºsys_*ï¼Œæ•…traceå¯¹åº”çš„ç³»ç»Ÿè°ƒç”¨å†™æˆsys_traceæ›´åŠ åˆç†ï¼‰ã€‚sys_traceéœ€è¦åšçš„æ˜¯å°†ç”¨æˆ·ä¼ å…¥çš„maskå†ä¼ ç»™å½“å‰è¿›ç¨‹åŠå…¶å­è¿›ç¨‹ã€‚</p><p>æˆ‘ä»¬è¿™é‡Œ<strong>å°†ç³»ç»Ÿè°ƒç”¨sys_traceçš„ç¼–å·è®¾ç½®ä¸º22</strong>ã€‚</p><h3 id=è¿›ç¨‹åŠå…¶å­è¿›ç¨‹å¦‚ä½•è·å–mask>è¿›ç¨‹åŠå…¶å­è¿›ç¨‹å¦‚ä½•è·å–maskï¼Ÿ<a hidden class=anchor aria-hidden=true href=#è¿›ç¨‹åŠå…¶å­è¿›ç¨‹å¦‚ä½•è·å–mask>#</a></h3><p>åœ¨xv6 bookçš„4.3èŠ‚ä¸­ï¼Œæœ‰è¿™ä¹ˆä¸€æ®µè¯ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>	syscall (kernel/syscall.c:132) retrieves the system call number from the saved a7 in the trapframe and uses it to index into syscalls. For the first system call, a7 contains SYS_exec (kernel/syscall.h:8),  resulting in a call to the system call implementation function sys_exec.
</span></span><span class=line><span class=cl>	
</span></span><span class=line><span class=cl>	When sys_exec returns, syscall records its return value in p-&gt;trapframe-&gt;a0. This will cause the original user-space call to exec() to return that value, since the C calling convention on RISC-V places return values in a0. System calls conventionally return negative numbers to indicate errors, and zero or positive numbers for success. If the system call number is invalid, syscall prints an error and returns âˆ’1.
</span></span></code></pre></div><p>å³ç³»ç»Ÿè°ƒç”¨çš„ç¼–å·ä¼šä¿å­˜åœ¨è¿›ç¨‹çš„trapframeä¸­ï¼Œæ ¹æ®a7å¯„å­˜å™¨å³å¯è·å¾—ï¼Œç³»ç»Ÿè°ƒç”¨çš„è¿”å›å€¼å¯é€šè¿‡a0å¯„å­˜å™¨è·å¾—ã€‚æ¬¸ï¼è¿™ä¸¤ä¸ªå€¼å¯ä¸å°±æ˜¯å®éªŒå®ç°ä¸­éœ€è¦çš„å—ï¼é‚£ä¹ˆç†æ‰€å½“ç„¶ï¼Œå®éªŒä¸­éœ€è¦æ‰“å°çš„è¯­å¥åº”è¯¥å°±åœ¨è¿™ä¸ªå‡½æ•°ä¸­æ·»åŠ ã€‚</p><p>è®©æˆ‘ä»¬æ¥çœ‹çœ‹xv6ä¸­è¿›ç¨‹çš„æ•°æ®ç»“æ„ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=c1>// kernel/proc.h
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=n>proc</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>struct</span> <span class=n>spinlock</span> <span class=n>lock</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1>// p-&gt;lock must be held when using these:
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=k>enum</span> <span class=n>procstate</span> <span class=n>state</span><span class=p>;</span>        <span class=c1>// Process state
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kt>void</span> <span class=o>*</span><span class=n>chan</span><span class=p>;</span>                  <span class=c1>// If non-zero, sleeping on chan
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kt>int</span> <span class=n>killed</span><span class=p>;</span>                  <span class=c1>// If non-zero, have been killed
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kt>int</span> <span class=n>xstate</span><span class=p>;</span>                  <span class=c1>// Exit status to be returned to parent&#39;s wait
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kt>int</span> <span class=n>pid</span><span class=p>;</span>                     <span class=c1>// Process ID
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>  <span class=c1>// wait_lock must be held when using this:
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=k>struct</span> <span class=n>proc</span> <span class=o>*</span><span class=n>parent</span><span class=p>;</span>         <span class=c1>// Parent process
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>  <span class=c1>// these are private to the process, so p-&gt;lock need not be held.
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=n>uint64</span> <span class=n>kstack</span><span class=p>;</span>               <span class=c1>// Virtual address of kernel stack
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=n>uint64</span> <span class=n>sz</span><span class=p>;</span>                   <span class=c1>// Size of process memory (bytes)
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kt>pagetable_t</span> <span class=n>pagetable</span><span class=p>;</span>       <span class=c1>// User page table
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=k>struct</span> <span class=n>trapframe</span> <span class=o>*</span><span class=n>trapframe</span><span class=p>;</span> <span class=c1>// data page for trampoline.S
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=k>struct</span> <span class=n>context</span> <span class=n>context</span><span class=p>;</span>      <span class=c1>// swtch() here to run process
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=k>struct</span> <span class=n>file</span> <span class=o>*</span><span class=n>ofile</span><span class=p>[</span><span class=n>NOFILE</span><span class=p>];</span>  <span class=c1>// Open files
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=k>struct</span> <span class=n>inode</span> <span class=o>*</span><span class=n>cwd</span><span class=p>;</span>           <span class=c1>// Current directory
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kt>char</span> <span class=n>name</span><span class=p>[</span><span class=mi>16</span><span class=p>];</span>               <span class=c1>// Process name (debugging)
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>  <span class=c1>// æ·»åŠ 
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kt>int</span> <span class=n>trace_mask</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>å¯ä»¥çœ‹åˆ°è¯¸å¦‚è¿›ç¨‹åã€pidã€ä¸Šä¸‹æ–‡ç­‰ä¿¡æ¯éƒ½æ˜¯ä¿å­˜åœ¨è¿™ä¸ªæ•°æ®ç»“æ„ä¸­ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥<strong>åœ¨å…¶ä¸­åŠ ä¸Šä¸€ä¸ªæˆå‘˜å˜é‡ <code>trace_mask</code> ç”¨äºä¿å­˜å½“å‰è¿›ç¨‹æ‰€å¯¹åº”traceå‘½ä»¤ä¸­çš„æ©ç mask</strong>ã€‚</p><p>xv6å·²ç»å®ç°äº†ç”¨æˆ·æ€çš„traceå‘½ä»¤ï¼Œå…¶ä½äº <code>user/trace.c</code> ä¸­ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&#34;kernel/param.h&#34;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&#34;kernel/types.h&#34;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&#34;kernel/stat.h&#34;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&#34;user/user.h&#34;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=kt>int</span>
</span></span><span class=line><span class=cl><span class=nf>main</span><span class=p>(</span><span class=kt>int</span> <span class=n>argc</span><span class=p>,</span> <span class=kt>char</span> <span class=o>*</span><span class=n>argv</span><span class=p>[])</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kt>int</span> <span class=n>i</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=kt>char</span> <span class=o>*</span><span class=n>nargv</span><span class=p>[</span><span class=n>MAXARG</span><span class=p>];</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>if</span><span class=p>(</span><span class=n>argc</span> <span class=o>&lt;</span> <span class=mi>3</span> <span class=o>||</span> <span class=p>(</span><span class=n>argv</span><span class=p>[</span><span class=mi>1</span><span class=p>][</span><span class=mi>0</span><span class=p>]</span> <span class=o>&lt;</span> <span class=sc>&#39;0&#39;</span> <span class=o>||</span> <span class=n>argv</span><span class=p>[</span><span class=mi>1</span><span class=p>][</span><span class=mi>0</span><span class=p>]</span> <span class=o>&gt;</span> <span class=sc>&#39;9&#39;</span><span class=p>)){</span>
</span></span><span class=line><span class=cl>    <span class=nf>fprintf</span><span class=p>(</span><span class=mi>2</span><span class=p>,</span> <span class=s>&#34;Usage: %s mask command</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span> <span class=n>argv</span><span class=p>[</span><span class=mi>0</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>    <span class=nf>exit</span><span class=p>(</span><span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=nf>trace</span><span class=p>(</span><span class=nf>atoi</span><span class=p>(</span><span class=n>argv</span><span class=p>[</span><span class=mi>1</span><span class=p>]))</span> <span class=o>&lt;</span> <span class=mi>0</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nf>fprintf</span><span class=p>(</span><span class=mi>2</span><span class=p>,</span> <span class=s>&#34;%s: trace failed</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span> <span class=n>argv</span><span class=p>[</span><span class=mi>0</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>    <span class=nf>exit</span><span class=p>(</span><span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  <span class=k>for</span><span class=p>(</span><span class=n>i</span> <span class=o>=</span> <span class=mi>2</span><span class=p>;</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=n>argc</span> <span class=o>&amp;&amp;</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=n>MAXARG</span><span class=p>;</span> <span class=n>i</span><span class=o>++</span><span class=p>){</span>
</span></span><span class=line><span class=cl>    <span class=n>nargv</span><span class=p>[</span><span class=n>i</span><span class=o>-</span><span class=mi>2</span><span class=p>]</span> <span class=o>=</span> <span class=n>argv</span><span class=p>[</span><span class=n>i</span><span class=p>];</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=nf>exec</span><span class=p>(</span><span class=n>nargv</span><span class=p>[</span><span class=mi>0</span><span class=p>],</span> <span class=n>nargv</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nf>exit</span><span class=p>(</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>å¯¹äºè¿™æ ·çš„ä¸€æ¡å‘½ä»¤ <code>trace 32 grep hello README</code> ï¼Œå‡è®¾å¼€å¯çš„è¿›ç¨‹åä¸ºpï¼Œé‚£ä¹ˆ32å°†ä¼šä¼ ç»™<code>p.trace_mask</code>ï¼Œä¹‹åçš„grepæ“ä½œå°†ä½¿ç”¨<code>exec</code><strong>åˆ›å»ºå­è¿›ç¨‹</strong>ï¼ˆå‡è®¾è¿›ç¨‹åä¸ºsonï¼‰æ‰§è¡Œï¼Œé‚£ä¹ˆåœ¨åˆ›å»ºå­è¿›ç¨‹ååº”è¯¥æœ‰<code>son.trace_mask = p.trace_mask</code>ï¼Œåªæœ‰è¿™æ ·ï¼Œgrepæ“ä½œæ‰€ç”¨åˆ°çš„ç³»ç»Ÿè°ƒç”¨æ‰èƒ½è¢«è·Ÿè¸ªåˆ°ã€‚</p><p>åœ¨ä½¿ç”¨traceå‘½ä»¤æ—¶ï¼Œå…¶åçš„maskå‚æ•°ä¼šå­˜åˆ°a0å¯„å­˜å™¨ä¸­ï¼Œä¸ºäº†ä»å…¶ä¸­æ‹¿åˆ°maskï¼Œå¯ä»¥ä½¿ç”¨<code>argint()</code>å‡½æ•°ï¼Œå…¶æºç ä¸ºï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=c1>// kernel/syscall.h
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=c1>// Fetch the nth 32-bit system call argument.
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kt>void</span> <span class=nf>argint</span><span class=p>(</span><span class=kt>int</span> <span class=n>n</span><span class=p>,</span> <span class=kt>int</span> <span class=o>*</span><span class=n>ip</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=o>*</span><span class=n>ip</span> <span class=o>=</span> <span class=nf>argraw</span><span class=p>(</span><span class=n>n</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>static</span> <span class=n>uint64</span> <span class=nf>argraw</span><span class=p>(</span><span class=kt>int</span> <span class=n>n</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>struct</span> <span class=n>proc</span> <span class=o>*</span><span class=n>p</span> <span class=o>=</span> <span class=nf>myproc</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  <span class=k>switch</span> <span class=p>(</span><span class=n>n</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>case</span> <span class=mi>0</span><span class=o>:</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>p</span><span class=o>-&gt;</span><span class=n>trapframe</span><span class=o>-&gt;</span><span class=n>a0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=k>case</span> <span class=mi>1</span><span class=o>:</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>p</span><span class=o>-&gt;</span><span class=n>trapframe</span><span class=o>-&gt;</span><span class=n>a1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=k>case</span> <span class=mi>2</span><span class=o>:</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>p</span><span class=o>-&gt;</span><span class=n>trapframe</span><span class=o>-&gt;</span><span class=n>a2</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=k>case</span> <span class=mi>3</span><span class=o>:</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>p</span><span class=o>-&gt;</span><span class=n>trapframe</span><span class=o>-&gt;</span><span class=n>a3</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=k>case</span> <span class=mi>4</span><span class=o>:</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>p</span><span class=o>-&gt;</span><span class=n>trapframe</span><span class=o>-&gt;</span><span class=n>a4</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=k>case</span> <span class=mi>5</span><span class=o>:</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>p</span><span class=o>-&gt;</span><span class=n>trapframe</span><span class=o>-&gt;</span><span class=n>a5</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=nf>panic</span><span class=p>(</span><span class=s>&#34;argraw&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=o>-</span><span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p><code>argint()</code>å†…è°ƒç”¨äº†<code>argraw()</code>ï¼Œåœ¨æŸ¥çœ‹ä»¥ä¸Šæºç åï¼Œç”±äºåªä¼ å…¥äº†ä¸€ä¸ªå‚æ•°ï¼Œæ•…åº”è¯¥å°†0ä¼ å…¥argrawä¸­ã€‚<strong>åœ¨<code>kernel/sysproc.c</code>ä¸­å®ç°<code>sys_trace()</code></strong>ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=c1>// kernel/sysproc.c
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=n>uint64</span> <span class=nf>sys_trace</span><span class=p>(</span><span class=kt>void</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kt>int</span> <span class=n>mask</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=nf>argint</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=o>&amp;</span><span class=n>mask</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=n>mask</span> <span class=o>&lt;</span> <span class=mi>0</span><span class=p>)</span> <span class=k>return</span> <span class=o>-</span><span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=k>struct</span> <span class=n>proc</span> <span class=o>*</span><span class=n>p</span> <span class=o>=</span> <span class=nf>myproc</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  <span class=n>p</span><span class=o>-&gt;</span><span class=n>trace_mask</span> <span class=o>=</span> <span class=n>mask</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>è¿™æ ·å½“traceä½¿ç”¨äº†åº•å±‚çš„sys_traceæ—¶ï¼Œå°±å¯ä»¥æŠŠmaskå‚æ•°ä¼ é€’ç»™å½“å‰è¿›ç¨‹ã€‚ä½†æ˜¯åªä¼ é€’ç»™å½“å‰è¿›ç¨‹è¿˜ä¸å¤Ÿï¼Œè¿˜è¦ä¼ ç»™å½“å‰è¿›ç¨‹çš„å­è¿›ç¨‹ã€‚åœ¨Linuxï¼Œæˆ‘ä»¬åˆ›å»ºå­è¿›ç¨‹çš„å‡½æ•°ä¸º<code>fork()</code>ï¼Œåœ¨xv6ä¸­ä¹ŸåŒæ ·å¦‚æ­¤ï¼Œforkå†…éƒ¨å…ˆè·å–å½“å‰è¿›ç¨‹çš„procç»“æ„ä½“ï¼Œç„¶åæ–°åˆ›å»ºä¸€ä¸ªprocç»“æ„ä½“ä»£è¡¨å­è¿›ç¨‹ï¼Œå¹¶å°†çˆ¶è¿›ç¨‹ä¸­çš„å€¼æ‹·è´è¿‡å»ï¼Œæ•…<strong>ä¼ é€’ç»™å­è¿›ç¨‹çš„maskä¹Ÿåœ¨å…¶ä¸­æ‹·è´</strong>ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=c1>// kernel/proc.c
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>fork</span><span class=p>(</span><span class=kt>void</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>  <span class=c1>// copy mask from father process to son process
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=c1>// npä¸ºå­è¿›ç¨‹ï¼Œpä¸ºçˆ¶è¿›ç¨‹
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=n>np</span><span class=o>-&gt;</span><span class=n>trace_mask</span> <span class=o>=</span> <span class=n>p</span><span class=o>-&gt;</span><span class=n>trace_mask</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=p>...</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>è¦æ³¨æ„ä¸€ä¸ªå°ç»†èŠ‚ï¼Œ<strong>å½“è¿›ç¨‹ç»“æ„ä½“è¢«é‡Šæ”¾æ—¶ï¼ˆè¿›ç¨‹ç»“æŸæˆ–è€…ä¸ºè¿›ç¨‹åˆ†é…procç»“æ„ä½“ï¼‰ï¼Œå…¶maskä¹Ÿè¯¥é‡ç½®</strong>ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=c1>// kernel/proc.c
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=k>static</span> <span class=kt>void</span> <span class=nf>freeproc</span><span class=p>(</span><span class=k>struct</span> <span class=n>proc</span> <span class=o>*</span><span class=n>p</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=c1>// ... ...
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=n>p</span><span class=o>-&gt;</span><span class=n>trace_mask</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>å®Œæˆå¥½ä»¥ä¸Šå†…å®¹åï¼Œå°±å¯ä»¥<strong>å®ç°sys_trace</strong>äº†ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=c1>// kernel/sysproc.c
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=n>uint64</span> <span class=nf>sys_trace</span><span class=p>(</span><span class=kt>void</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kt>int</span> <span class=n>mask</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=nf>argint</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=o>&amp;</span><span class=n>mask</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=n>mask</span> <span class=o>&lt;</span> <span class=mi>0</span><span class=p>)</span> <span class=k>return</span> <span class=o>-</span><span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=k>struct</span> <span class=n>proc</span> <span class=o>*</span><span class=n>p</span> <span class=o>=</span> <span class=nf>myproc</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  <span class=n>p</span><span class=o>-&gt;</span><span class=n>trace_mask</span> <span class=o>=</span> <span class=n>mask</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>è¿™æ ·ï¼Œå½“å‰è¿›ç¨‹å°±å¯ä»¥è·å–äº†åˆ°maskï¼Œå½“å…¶åˆ›å»ºå­è¿›ç¨‹æ—¶ï¼Œå­è¿›ç¨‹ä¹Ÿå¯è·å–åˆ°mask~</p><h3 id=å¦‚ä½•è·Ÿè¸ªç³»ç»Ÿè°ƒç”¨>å¦‚ä½•è·Ÿè¸ªç³»ç»Ÿè°ƒç”¨ï¼Ÿ<a hidden class=anchor aria-hidden=true href=#å¦‚ä½•è·Ÿè¸ªç³»ç»Ÿè°ƒç”¨>#</a></h3><p>åˆšåˆšæˆ‘ä»¬è¯´äº†maskçš„ä½œç”¨ï¼Œè¿˜æœ‰è¿›ç¨‹åŠå…¶å­è¿›ç¨‹å¦‚ä½•è·å–maskï¼Œé‚£ä¹ˆæˆ‘ä»¬åˆåº”è¯¥å¦‚ä½•è·Ÿè¸ªç³»ç»Ÿè°ƒç”¨å‘¢ï¼Ÿ</p><p>xv6ä¸­æ‰€ç”¨çš„ç³»ç»Ÿè°ƒç”¨éƒ½æ˜¯åœ¨ <code>kernel/syscall.c</code> ä¸­çš„ <code>syscall</code> å‡½æ•°ä¸­è°ƒç”¨çš„ï¼Œä¸ºäº†èƒ½åœ¨syscall.cä¸­è°ƒç”¨sys_traceï¼Œéœ€è¦åœ¨å…¶ä¸­<strong>æ·»åŠ externå£°æ˜</strong>ï¼ˆå…¶å®šä¹‰åœ¨åˆšåˆšå·²ç»å®ç°ï¼Œä½äºkernel/sysproc.cï¼‰ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=k>extern</span> <span class=n>uint64</span> <span class=nf>sys_trace</span><span class=p>(</span><span class=kt>void</span><span class=p>);</span>
</span></span></code></pre></div><p>åŒæ—¶éœ€è¦<strong>åœ¨syscallsæ•°ç»„ä¸­æ·»åŠ sys_traceçš„ç¼–å·</strong>ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=k>static</span> <span class=nf>uint64</span> <span class=p>(</span><span class=o>*</span><span class=n>syscalls</span><span class=p>[])(</span><span class=kt>void</span><span class=p>)</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl><span class=c1>// ... ...
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>[</span><span class=n>SYS_trace</span><span class=p>]</span>   <span class=n>sys_trace</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// è¿™é‡Œå®é™…ä¸Šå°±æ˜¯ [22] = sys_trace
</span></span></span><span class=line><span class=cl><span class=c1>// ä½¿ç”¨äº†gccçš„ä¸€ä¸ªæ‹“å±•
</span></span></span></code></pre></div><p>å¹¶æŒ‰ç…§é¡ºåº<strong>æ·»åŠ å„ä¸ªç³»ç»Ÿè°ƒç”¨çš„åå­—</strong>ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=kt>char</span> <span class=o>*</span><span class=n>syscall_names</span><span class=p>[]</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=s>&#34;fork&#34;</span><span class=p>,</span> <span class=s>&#34;exit&#34;</span><span class=p>,</span> <span class=s>&#34;wait&#34;</span><span class=p>,</span> <span class=s>&#34;pipe&#34;</span><span class=p>,</span> <span class=s>&#34;read&#34;</span><span class=p>,</span> <span class=s>&#34;kill&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=s>&#34;exec&#34;</span><span class=p>,</span> <span class=s>&#34;fstat&#34;</span><span class=p>,</span> <span class=s>&#34;chdir&#34;</span><span class=p>,</span> <span class=s>&#34;dup&#34;</span><span class=p>,</span> <span class=s>&#34;getpid&#34;</span><span class=p>,</span> <span class=s>&#34;sbrk&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=s>&#34;sleep&#34;</span><span class=p>,</span> <span class=s>&#34;uptime&#34;</span><span class=p>,</span> <span class=s>&#34;open&#34;</span><span class=p>,</span> <span class=s>&#34;write&#34;</span><span class=p>,</span> <span class=s>&#34;mknod&#34;</span><span class=p>,</span> <span class=s>&#34;unlink&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=s>&#34;link&#34;</span><span class=p>,</span> <span class=s>&#34;mkdir&#34;</span><span class=p>,</span> <span class=s>&#34;close&#34;</span><span class=p>,</span> <span class=s>&#34;trace&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span></code></pre></div><p>åœ¨ <code>kernel/syscall.c</code> ä¸­ï¼Œxv6æ ¹æ®a7å¯„å­˜å™¨è·å–ç³»ç»Ÿè°ƒç”¨çš„ç¼–å·ï¼Œç„¶åé€šè¿‡syscallså‡½æ•°æ•°ç»„æ‰§è¡Œç³»ç»Ÿè°ƒç”¨ï¼Œé‚£ä¹ˆæˆ‘ä»¬çš„å®ç°ä¸ºï¼šå½“ä½¿ç”¨çš„ç³»ç»Ÿè°ƒç”¨åˆæ³•æ—¶ï¼Œè·å–å½“å‰è¿›ç¨‹çš„maskï¼Œå¹¶é€šè¿‡åˆ¤æ–­<code>(mask >> syscall_num) & 1</code>æ˜¯å¦ä¸º1æ¥è¾“å‡ºè·Ÿè¸ªä¿¡æ¯ã€‚</p><p>ä¾‹å¦‚sys_readç³»ç»Ÿè°ƒç”¨çš„ç¼–å·ä¸º5ï¼Œmaskä¸º32ï¼Œåˆ™<code>(32 >> 5) & 1 = 1</code>ã€‚</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=kt>void</span> <span class=nf>syscall</span><span class=p>(</span><span class=kt>void</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kt>int</span> <span class=n>num</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=k>struct</span> <span class=n>proc</span> <span class=o>*</span><span class=n>p</span> <span class=o>=</span> <span class=nf>myproc</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=n>num</span> <span class=o>=</span> <span class=n>p</span><span class=o>-&gt;</span><span class=n>trapframe</span><span class=o>-&gt;</span><span class=n>a7</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span><span class=p>(</span><span class=n>num</span> <span class=o>&gt;</span> <span class=mi>0</span> <span class=o>&amp;&amp;</span> <span class=n>num</span> <span class=o>&lt;</span> <span class=nf>NELEM</span><span class=p>(</span><span class=n>syscalls</span><span class=p>)</span> <span class=o>&amp;&amp;</span> <span class=n>syscalls</span><span class=p>[</span><span class=n>num</span><span class=p>])</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// Use num to lookup the system call function for num, call it,
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=c1>// and store its return value in p-&gt;trapframe-&gt;a0
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>p</span><span class=o>-&gt;</span><span class=n>trapframe</span><span class=o>-&gt;</span><span class=n>a0</span> <span class=o>=</span> <span class=n>syscalls</span><span class=p>[</span><span class=n>num</span><span class=p>]();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=c1>// ===============================
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kt>int</span> <span class=n>mask</span> <span class=o>=</span> <span class=n>p</span><span class=o>-&gt;</span><span class=n>trace_mask</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>((</span><span class=n>mask</span> <span class=o>&gt;&gt;</span> <span class=n>num</span><span class=p>)</span> <span class=o>&amp;</span> <span class=mi>1</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;%d: syscall %s -&gt; %d</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span> <span class=n>p</span><span class=o>-&gt;</span><span class=n>pid</span><span class=p>,</span> <span class=n>syscall_names</span><span class=p>[</span><span class=n>num</span> <span class=o>-</span> <span class=mi>1</span><span class=p>],</span> <span class=n>p</span><span class=o>-&gt;</span><span class=n>trapframe</span><span class=o>-&gt;</span><span class=n>a0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=c1>// ===============================
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>  <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;%d %s: unknown sys call %d</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>p</span><span class=o>-&gt;</span><span class=n>pid</span><span class=p>,</span> <span class=n>p</span><span class=o>-&gt;</span><span class=n>name</span><span class=p>,</span> <span class=n>num</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>p</span><span class=o>-&gt;</span><span class=n>trapframe</span><span class=o>-&gt;</span><span class=n>a0</span> <span class=o>=</span> <span class=o>-</span><span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>é‚£ä¹ˆï¼Œå†…æ ¸æ˜¯å¦‚ä½•é€šè¿‡traceæ‰¾åˆ°sys_traceçš„å‘¢ï¼Ÿæ ¹æ®å®éªŒæŒ‡å¯¼ä¸Šçš„æç¤ºï¼Œå¯ä»¥çŸ¥é“ <code>user/usys.pl</code> èµ·åˆ°äº†ä¸€ä¸ªä¸­é—´äººçš„ä½œç”¨ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-diff data-lang=diff><span class=line><span class=cl># user/usys.pl
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>...
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>sub entry {
</span></span><span class=line><span class=cl>    my $name = shift;
</span></span><span class=line><span class=cl>    print &#34;.global $name\n&#34;;
</span></span><span class=line><span class=cl>    print &#34;${name}:\n&#34;;
</span></span><span class=line><span class=cl>    print &#34; li a7, SYS_${name}\n&#34;;
</span></span><span class=line><span class=cl>    print &#34; ecall\n&#34;;
</span></span><span class=line><span class=cl>    print &#34; ret\n&#34;;
</span></span><span class=line><span class=cl>}
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>...
</span></span><span class=line><span class=cl>entry(&#34;uptime&#34;);
</span></span><span class=line><span class=cl><span class=gi>++entry(&#34;trace&#34;); # è¿™æ˜¯å®éªŒä¸­éœ€è¦ç”±æˆ‘ä»¬è‡ªå·±æ·»åŠ çš„
</span></span></span></code></pre></div><p>é€šè¿‡å…¶ä¸­çš„entryå‡½æ•°ï¼Œå¯ä»¥ç”Ÿæˆå¯¹åº”çš„è°ƒç”¨ï¼ˆxv6ä¸­ä¸ºecallï¼‰ç³»ç»Ÿè°ƒç”¨çš„æ±‡ç¼–è¯­å¥ï¼Œå³å¤§è‡´çš„æµç¨‹ä¸ºxv6åœ¨æ„å»ºå†…æ ¸æ—¶ï¼Œä¼šå°†ç”¨æˆ·æ€traceå‘½ä»¤å¯¹åº”åˆ°ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-asm data-lang=asm><span class=line><span class=cl><span class=na>.global</span> <span class=no>trace</span>
</span></span><span class=line><span class=cl><span class=nl>trace:</span>
</span></span><span class=line><span class=cl>    <span class=nf>li</span> <span class=no>a7</span><span class=p>,</span> <span class=no>SYS_trace</span>
</span></span><span class=line><span class=cl>    <span class=nf>ecall</span>
</span></span><span class=line><span class=cl>    <span class=nf>ret</span>
</span></span></code></pre></div><p>è¿™æ ·ï¼Œå½“å‰è¿›ç¨‹å°±å¯ä»¥é€šè¿‡a7å¯„å­˜å™¨æ‹¿åˆ°sys_traceçš„ç³»ç»Ÿè°ƒç”¨ç¼–å·äº†ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œ<code>syscall</code> å‡½æ•°å¯ä»¥è°ƒç”¨ <code>sys_trace</code> äº†ã€‚</p><p>OKï¼Œé‚£ä¹ˆä¸€ä¸ªå¤§è‡´çš„æ¡†æ¶å°±å‡ºæ¥äº†ï¼š</p><p><div class=post-img-view><a data-fancybox=gallery href=https://s2.loli.net/2024/12/16/U2PElyAr1aZYxFe.png><img src=https://s2.loli.net/2024/12/16/U2PElyAr1aZYxFe.png alt></a></div></p><p>å®Œæˆä¸Šé¢çš„æ­¥éª¤åï¼Œæœ€ååªè¦åœ¨<code>Makefile</code>ä¸­çš„<code>UPROGS</code>åŠ ä¸Š<code>$U/_trace</code>å³å¯ã€‚</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-diff data-lang=diff><span class=line><span class=cl>UPROGS=\
</span></span><span class=line><span class=cl>	$U/_cat\
</span></span><span class=line><span class=cl>	$U/_echo\
</span></span><span class=line><span class=cl>	$U/_forktest\
</span></span><span class=line><span class=cl>	$U/_grep\
</span></span><span class=line><span class=cl>	$U/_init\
</span></span><span class=line><span class=cl>	$U/_kill\
</span></span><span class=line><span class=cl>	$U/_ln\
</span></span><span class=line><span class=cl>	$U/_ls\
</span></span><span class=line><span class=cl>	$U/_mkdir\
</span></span><span class=line><span class=cl>	$U/_rm\
</span></span><span class=line><span class=cl>	$U/_sh\
</span></span><span class=line><span class=cl>	$U/_stressfs\
</span></span><span class=line><span class=cl>	$U/_usertests\
</span></span><span class=line><span class=cl>	$U/_grind\
</span></span><span class=line><span class=cl>	$U/_wc\
</span></span><span class=line><span class=cl>	$U/_zombie\
</span></span><span class=line><span class=cl><span class=gi>++	$U/_trace
</span></span></span></code></pre></div><p>åœ¨è¿™ä¸ªlabä¸­ï¼Œæˆ‘ä»¬éœ€è¦æ·»åŠ ä¸€ä¸ªç³»ç»Ÿè°ƒç”¨sysinfoï¼Œç”¨äºæ”¶é›†æœ‰å…³æ­£åœ¨è¿è¡Œçš„ç³»ç»Ÿçš„ä¿¡æ¯ã€‚</p><p>ç³»ç»Ÿè°ƒç”¨çš„å£°æ˜ä¸ºï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=kt>int</span> <span class=nf>sysinfo</span><span class=p>(</span><span class=k>struct</span> <span class=n>sysinfo</span><span class=o>*</span><span class=p>);</span>
</span></span></code></pre></div><p>è¿™ä¸ªç³»ç»Ÿè°ƒç”¨æ¥å—ä¸€ä¸ªæŒ‡å‘ç»“æ„ä½“sysinfoçš„æŒ‡é’ˆï¼Œå…¶å®šä¹‰ä¸ºï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=c1>// kernel/sysinfo.h
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=n>sysinfo</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>uint64</span> <span class=n>freemem</span><span class=p>;</span>   <span class=c1>// amount of free memory (bytes)
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=n>uint64</span> <span class=n>nproc</span><span class=p>;</span>     <span class=c1>// number of process
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>};</span>
</span></span></code></pre></div><p>å†…æ ¸åº”å¡«å†™æ­¤ç»“æ„çš„å­—æ®µï¼šfreememå­—æ®µåº”è®¾ç½®ä¸ºå¯ç”¨å†…å­˜çš„<strong>å­—èŠ‚æ•°</strong>ï¼Œnprocå­—æ®µåº”è®¾ä¸º<strong>çŠ¶æ€æœªä½¿ç”¨</strong>çš„è¿›ç¨‹æ•°ã€‚</p><h2 id=sysinfo>sysinfo<a hidden class=anchor aria-hidden=true href=#sysinfo>#</a></h2><p>åœ¨è¿™ä¸ªpartä¸­ï¼Œæˆ‘ä»¬éœ€è¦æ·»åŠ ä¸€ä¸ªç³»ç»Ÿè°ƒç”¨sysinfoï¼Œç”¨äºæ”¶é›†æœ‰å…³æ­£åœ¨è¿è¡Œçš„ç³»ç»Ÿçš„ä¿¡æ¯ã€‚</p><h3 id=è®¡ç®—å¯ç”¨å†…å­˜å­—èŠ‚æ•°>è®¡ç®—å¯ç”¨å†…å­˜å­—èŠ‚æ•°<a hidden class=anchor aria-hidden=true href=#è®¡ç®—å¯ç”¨å†…å­˜å­—èŠ‚æ•°>#</a></h3><p>æˆ‘ä»¬å¯ä»¥é€šè¿‡å†…æ ¸ä¸­çš„<code>kmem</code>æ¥è·å–å¯ç”¨çš„å†…å­˜å—çš„æ•°é‡ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=k>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>struct</span> <span class=n>spinlock</span> <span class=n>lock</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=k>struct</span> <span class=n>run</span> <span class=o>*</span><span class=n>freelist</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span> <span class=n>kmem</span><span class=p>;</span>
</span></span></code></pre></div><p><code>kmem.freelist</code>æ˜¯ä¸€ä¸ªé“¾è¡¨ï¼Œä¿å­˜äº†æ‰€æœ‰<strong>å¯ç”¨</strong>çš„å†…å­˜å—çš„åœ°å€ï¼Œæˆ‘ä»¬éå†è¿™ä¸ªé“¾è¡¨å³å¯è·å–å¯ç”¨å†…å­˜å—æ•°é‡ï¼Œåˆä¸€ä¸ªå†…å­˜å—çš„å¤§å°ä¸º4KBï¼Œé‚£ä¹ˆ<code>ç³»ç»Ÿå¯ç”¨çš„å†…å­˜å­—èŠ‚æ•° = å¯ç”¨å†…å­˜å—æ•°é‡ * 4KB</code>ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=c1>// kernel/kalloc.c
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=n>uint64</span> <span class=nf>freemem</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>struct</span> <span class=n>run</span><span class=o>*</span> <span class=n>r</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>uint64</span> <span class=n>free_page</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=nf>acquire</span><span class=p>(</span><span class=o>&amp;</span><span class=n>kmem</span><span class=p>.</span><span class=n>lock</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=n>r</span> <span class=o>=</span> <span class=n>kmem</span><span class=p>.</span><span class=n>freelist</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=k>while</span> <span class=p>(</span><span class=n>r</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>free_page</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>r</span> <span class=o>=</span> <span class=n>r</span><span class=o>-&gt;</span><span class=n>next</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=nf>release</span><span class=p>(</span><span class=o>&amp;</span><span class=n>kmem</span><span class=p>.</span><span class=n>lock</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=c1>// 4K = 2^12ï¼Œå·¦ç§»æ“ä½œç›¸å½“äºå¯¹2çš„ä¹˜æ³•
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=k>return</span> <span class=p>(</span><span class=n>free_page</span> <span class=o>&lt;&lt;</span> <span class=mi>12</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h3 id=è®¡ç®—çŠ¶æ€ä¸ºæœªä¸ºä½¿ç”¨è¿›ç¨‹æ•°>è®¡ç®—çŠ¶æ€ä¸ºæœªä¸ºä½¿ç”¨è¿›ç¨‹æ•°<a hidden class=anchor aria-hidden=true href=#è®¡ç®—çŠ¶æ€ä¸ºæœªä¸ºä½¿ç”¨è¿›ç¨‹æ•°>#</a></h3><p>å†…æ ¸ä¸­æœ‰ä¸€ä¸ªå…¨å±€æ•°ç»„ï¼Œå…¶ä¸­æ¯ä¸€é¡¹ä¸ºç³»ç»Ÿä¸­çš„è¿›ç¨‹ï¼Œxv6ä¸­è®¾ç½®æœ€å¤šè¿›ç¨‹æ•°ä¸º64ä¸ªï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=k>struct</span> <span class=n>proc</span> <span class=n>proc</span><span class=p>[</span><span class=n>NPROC</span><span class=p>];</span>
</span></span></code></pre></div><p>åœ¨è¡¨ç¤ºè¿›ç¨‹çš„ç»“æ„ä½“ä¸­ï¼Œæœ‰ä¸€ä¸ªæˆå‘˜è¡¨ç¤ºè¿™ä¸ªè¿›ç¨‹çš„çŠ¶æ€ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=k>enum</span> <span class=n>procstate</span> <span class=p>{</span> <span class=n>UNUSED</span><span class=p>,</span> <span class=n>USED</span><span class=p>,</span> <span class=n>SLEEPING</span><span class=p>,</span> <span class=n>RUNNABLE</span><span class=p>,</span> <span class=n>RUNNING</span><span class=p>,</span> <span class=n>ZOMBIE</span> <span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Per-process state
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>struct</span> <span class=n>proc</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=p>...</span>
</span></span><span class=line><span class=cl>  <span class=c1>// p-&gt;lock must be held when using these:
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=k>enum</span> <span class=n>procstate</span> <span class=n>state</span><span class=p>;</span> 
</span></span><span class=line><span class=cl>  <span class=p>...</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>æˆ‘ä»¬å¯ä»¥éå†procæ•°ç»„ï¼Œæ‰¾åˆ°æ‰€æœ‰<code>state != UNUSED</code>çš„è¿›ç¨‹çš„æ•°é‡ï¼ˆè¿™é‡Œä¸€å®šè¦çœ‹æ¸…æ¥šï¼Œæ˜¯<strong>çŠ¶æ€ä¸ºæœªä½¿ç”¨</strong>çš„è¿›ç¨‹æ•°ï¼Œè€Œä¸æ˜¯æœªä½¿ç”¨çš„è¿›ç¨‹æ•°ï¼‰ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=c1>// kernel/proc.c
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=n>uint64</span> <span class=nf>nproc</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>struct</span> <span class=n>proc</span><span class=o>*</span> <span class=n>p</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>uint64</span> <span class=n>not_unused</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>for</span> <span class=p>(</span><span class=n>p</span> <span class=o>=</span> <span class=n>proc</span><span class=p>;</span> <span class=n>p</span> <span class=o>&lt;</span> <span class=o>&amp;</span><span class=n>proc</span><span class=p>[</span><span class=n>NPROC</span><span class=p>];</span> <span class=n>p</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=n>p</span><span class=o>-&gt;</span><span class=n>state</span> <span class=o>!=</span> <span class=n>UNUSED</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=n>not_unused</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=n>not_unused</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h3 id=å®Œæˆç³»ç»Ÿè°ƒç”¨>å®Œæˆç³»ç»Ÿè°ƒç”¨<a hidden class=anchor aria-hidden=true href=#å®Œæˆç³»ç»Ÿè°ƒç”¨>#</a></h3><blockquote><p>å¦‚ä½•è·å–ç”¨æˆ·æ€ä¼ é€’è¿‡æ¥çš„å‚æ•°å’Œæ³¨å†Œç³»ç»Ÿè°ƒç”¨å¯ä»¥å‚è€ƒè¿™ç¯‡<a href=https://kerolt.github.io/posts/18ad9abb/#%E5%A6%82%E4%BD%95%E8%B7%9F%E8%B8%AA%E7%B3%BB%E7%BB%9F%E8%B0%83%E7%94%A8%EF%BC%9F>åšå®¢</a>ï¼Œè¿™é‡Œå°±ä¸èµ˜è¿°äº†</p></blockquote><p>æˆ‘ä»¬åˆ›å»ºäº†<code>struct sysinfo</code>ç»“æ„ä½“å˜é‡<code>info</code>åï¼Œä½¿ç”¨åˆšåˆšçš„<code>freemem</code>å’Œ<code>nproc</code>å‡½æ•°æ¥ä¸ºç»“æ„ä½“å˜é‡èµ‹å€¼ï¼Œä¹‹åé€šè¿‡<code>copyout</code>å‡½æ•°å°†å†…æ ¸æ€ä¸­çš„<code>info</code>æ‹·è´ç»™ç”¨æˆ·æ€çš„<code>struct sysinfo</code>ç»“æ„ä½“å˜é‡ã€‚</p><p>è¿™é‡Œçš„å®ç°åŸç†æ˜¯ï¼šç”¨æˆ·æ€ä¸‹æˆ‘ä»¬ä½¿ç”¨ç³»ç»Ÿè°ƒç”¨ä¼ é€’äº†ä¸€ä¸ª<code>struct sysinfo</code>æŒ‡é’ˆï¼Œå…¶å®å°±æ˜¯ä¼ é€’äº†ä¸€ä¸ªå†…å­˜åœ°å€<code>addr</code>ï¼›å†…æ ¸æ€ä¸‹æˆ‘ä»¬å°†<code>info</code>ä¸­çš„æ•°æ®åŸå°ä¸åŠ¨åœ°æ¬ä¸€ä»½åˆ°<code>addr</code>å¤„ã€‚è¿™æ ·å½“ç”¨æˆ·æ€è®¿é—®<code>addr</code>å¤„çš„å†…å­˜æ—¶å°±å¯ä»¥è·å–åˆ°æƒ³è¦çš„æ•°æ®äº†ã€‚</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=n>uint64</span> <span class=nf>sys_sysinfo</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>uint64</span> <span class=n>addr</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=nf>argaddr</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=o>&amp;</span><span class=n>addr</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=n>addr</span> <span class=o>&lt;</span> <span class=mi>0</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=o>-</span><span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>struct</span> <span class=n>proc</span><span class=o>*</span> <span class=n>p</span> <span class=o>=</span> <span class=nf>myproc</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  <span class=k>struct</span> <span class=n>sysinfo</span> <span class=n>info</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=n>info</span><span class=p>.</span><span class=n>freemem</span> <span class=o>=</span> <span class=nf>freemem</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  <span class=n>info</span><span class=p>.</span><span class=n>nproc</span> <span class=o>=</span> <span class=nf>nproc</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=nf>copyout</span><span class=p>(</span><span class=n>p</span><span class=o>-&gt;</span><span class=n>pagetable</span><span class=p>,</span> <span class=n>addr</span><span class=p>,</span> <span class=p>(</span><span class=kt>char</span><span class=o>*</span><span class=p>)</span><span class=o>&amp;</span><span class=n>info</span><span class=p>,</span> <span class=k>sizeof</span><span class=p>(</span><span class=n>info</span><span class=p>)))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=o>-</span><span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div></div><footer class=post-footer><nav class=paginav><a class=prev href=https://kerolt.github.io/posts/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/mit6.s081lab3-page-tables%E4%B8%8B/><span class=title>Â« Prev</span><br><span>ã€MIT6.S081ã€‘Lab3 page tablesï¼ˆä¸‹ï¼‰</span>
</a><a class=next href=https://kerolt.github.io/posts/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/mit6.s081lab1-utilities/><span class=title>Next Â»</span><br><span>ã€MIT6.S081ã€‘Lab1 utilities</span></a></nav><ul class=share-buttons><li><a target=_blank rel="noopener noreferrer" aria-label="share ã€MIT6.S081ã€‘Lab2 system calls on x" href="https://x.com/intent/tweet/?text=%e3%80%90MIT6.S081%e3%80%91Lab2%20system%20calls&amp;url=https%3a%2f%2fkerolt.github.io%2fposts%2f%25E6%2593%258D%25E4%25BD%259C%25E7%25B3%25BB%25E7%25BB%259F%2fmit6.s081lab2-system-calls%2f&amp;hashtags=OS%2cMIT6-S081"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446C483.971.0 512 28.03 512 62.554zM269.951 190.75 182.567 75.216H56L207.216 272.95 63.9 436.783h61.366L235.9 310.383l96.667 126.4H456L298.367 228.367l134-153.151H371.033zM127.633 110h36.468l219.38 290.065H349.5z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share ã€MIT6.S081ã€‘Lab2 system calls on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2fkerolt.github.io%2fposts%2f%25E6%2593%258D%25E4%25BD%259C%25E7%25B3%25BB%25E7%25BB%259F%2fmit6.s081lab2-system-calls%2f&amp;title=%e3%80%90MIT6.S081%e3%80%91Lab2%20system%20calls&amp;summary=%e3%80%90MIT6.S081%e3%80%91Lab2%20system%20calls&amp;source=https%3a%2f%2fkerolt.github.io%2fposts%2f%25E6%2593%258D%25E4%25BD%259C%25E7%25B3%25BB%25E7%25BB%259F%2fmit6.s081lab2-system-calls%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share ã€MIT6.S081ã€‘Lab2 system calls on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fkerolt.github.io%2fposts%2f%25E6%2593%258D%25E4%25BD%259C%25E7%25B3%25BB%25E7%25BB%259F%2fmit6.s081lab2-system-calls%2f&title=%e3%80%90MIT6.S081%e3%80%91Lab2%20system%20calls"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share ã€MIT6.S081ã€‘Lab2 system calls on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fkerolt.github.io%2fposts%2f%25E6%2593%258D%25E4%25BD%259C%25E7%25B3%25BB%25E7%25BB%259F%2fmit6.s081lab2-system-calls%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share ã€MIT6.S081ã€‘Lab2 system calls on whatsapp" href="https://api.whatsapp.com/send?text=%e3%80%90MIT6.S081%e3%80%91Lab2%20system%20calls%20-%20https%3a%2f%2fkerolt.github.io%2fposts%2f%25E6%2593%258D%25E4%25BD%259C%25E7%25B3%25BB%25E7%25BB%259F%2fmit6.s081lab2-system-calls%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share ã€MIT6.S081ã€‘Lab2 system calls on telegram" href="https://telegram.me/share/url?text=%e3%80%90MIT6.S081%e3%80%91Lab2%20system%20calls&amp;url=https%3a%2f%2fkerolt.github.io%2fposts%2f%25E6%2593%258D%25E4%25BD%259C%25E7%25B3%25BB%25E7%25BB%259F%2fmit6.s081lab2-system-calls%2f"><svg viewBox="2 2 28 28" height="30" width="30" fill="currentcolor"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share ã€MIT6.S081ã€‘Lab2 system calls on ycombinator" href="https://news.ycombinator.com/submitlink?t=%e3%80%90MIT6.S081%e3%80%91Lab2%20system%20calls&u=https%3a%2f%2fkerolt.github.io%2fposts%2f%25E6%2593%258D%25E4%25BD%259C%25E7%25B3%25BB%25E7%25BB%259F%2fmit6.s081lab2-system-calls%2f"><svg width="30" height="30" viewBox="0 0 512 512" fill="currentcolor" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"><path d="M449.446.0C483.971.0 512 28.03 512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446zM183.8767 87.9921h-62.034L230.6673 292.4508V424.0079h50.6655V292.4508L390.1575 87.9921H328.1233L256 238.2489z"/></svg></a></li></ul></footer></article></main><footer class=footer><span>&copy; 2025 <a href=https://kerolt.github.io/>Kerolt's Blog</a></span> Â·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>